import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCmltcG9ydCB1cmxsaWINCmltcG9ydCB1cmxsaWIyDQppbXBvcnQgcmUsIHJlcXVlc3RzDQppbXBvcnQgb3MNCmltcG9ydCB4Ym1jcGx1Z2luDQppbXBvcnQgeGJtY2d1aQ0KaW1wb3J0IHhibWNhZGRvbg0KaW1wb3J0IHhibWN2ZnMNCmltcG9ydCB0cmFjZWJhY2sNCmltcG9ydCBjb29raWVsaWIsYmFzZTY0LHBrY3M1DQpmcm9tIEJlYXV0aWZ1bFNvdXAgaW1wb3J0IEJlYXV0aWZ1bFN0b25lU291cCwgQmVhdXRpZnVsU291cCwgQmVhdXRpZnVsU09BUA0Kdmlld21vZGU9Tm9uZQ0KdHJ5Og0KICAgIGZyb20geG1sLnNheC5zYXh1dGlscyBpbXBvcnQgZXNjYXBlDQpleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQ0KdHJ5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQ6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbg0KaW1wb3J0IFNpbXBsZURvd25sb2FkZXIgYXMgZG93bmxvYWRlcg0KaW1wb3J0IHRpbWUNCnRzZG93bmxvYWRlcj1GYWxzZQ0KaGxzcmV0cnk9RmFsc2UNCnJlc29sdmVfdXJsPVsnMTgwdXBsb2FkLmNvbScsICdhbGxteXZpZGVvcy5uZXQnLCAnYmVzdHJlYW1zLm5ldCcsICdjbGlja251cGxvYWQuY29tJywgJ2Nsb3VkemlsbGEudG8nLCAnbW92c2hhcmUubmV0JywgJ25vdmFtb3YuY29tJywgJ25vd3ZpZGVvLnN4JywgJ3ZpZGVvd2VlZC5lcycsICdkYWNsaXBzLmluJywgJ2RhdGVtdWxlLmNvbScsICdmYXN0dmlkZW8uaW4nLCAnZmFzdHN0cmVhbS5pbicsICdmaWxlaG9vdC5jb20nLCAnZmlsZW51a2UuY29tJywgJ3NoYXJlc2l4LmNvbScsICAncGx1cy5nb29nbGUuY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvcmlsbGF2aWQuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ3JpZnRob3N0LmNvbScsICdodWdlZmlsZXMubmV0JywgJ2lwaXRob3MudG8nLCAnaXNoYXJlZC5ldScsICdraW5nZmlsZXMubmV0JywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ21pZ2h0eXVwbG9hZC5jb20nLCAnbW9vc2hhcmUuYml6JywgJ21vdmRpdnguY29tJywgJ21vdnBvZC5uZXQnLCAnbW92cG9kLmluJywgJ21vdnJlZWwuY29tJywgJ21yZmlsZS5tZScsICdub3N2aWRlby5jb20nLCAnb3BlbmxvYWQuaW8nLCAncGxheWVkLnRvJywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdzaGFyZXJlcG8uY29tJywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3RoZWZpbGUubWUnLCAndGhldmlkZW8ubWUnLCAndHVzZmlsZXMubmV0JywgJ3VwbG9hZGMuY29tJywgJ3phbGFhLmNvbScsICd1cGxvYWRyb2NrZXQubmV0JywgJ3VwdG9ib3guY29tJywgJ3Ytdmlkcy5jb20nLCAndmVlaGQuY29tJywgJ3ZpZGJ1bGwuY29tJywgJ3ZpZGVvbWVnYS50dicsICd2aWRwbGF5Lm5ldCcsICd2aWRzcG90Lm5ldCcsICd2aWR0by5tZScsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndmsuY29tJywgJ3ZvZGxvY2tlci5jb20nLCAneGZpbGVsb2FkLmNvbScsICd4dmlkc3RhZ2UuY29tJywgJ3pldHRhaG9zdC50diddDQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10NCmdsb2JhbCBnTFNQcm9EeW5hbWljQ29kZU51bWJlcg0KZ0xTUHJvRHluYW1pY0NvZGVOdW1iZXI9MA0KY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6DQogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6DQogICAgICAgcmV0dXJuIHJlc3BvbnNlDQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UNCg0KUkVNT1RFX0RCRz1GYWxzZQ0KaWYgUkVNT1RFX0RCRzoNCiAgICAjIE1ha2UgcHlkZXYgZGVidWdnZXIgd29ya3MgZm9yIGF1dG8gcmVsb2FkLg0KICAgICMgTm90ZSBweWRldmQgbW9kdWxlIG5lZWQgdG8gYmUgY29waWVkIGluIFhCTUNcc3lzdGVtXHB5dGhvblxMaWJccHlzcmMNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCBweXNyYy5weWRldmQgYXMgcHlkZXZkDQogICAgICAgIHB5ZGV2ZC5zZXR0cmFjZSgnbG9jYWxob3N0Jywgc3Rkb3V0VG9TZXJ2ZXI9VHJ1ZSwgc3RkZXJyVG9TZXJ2ZXI9VHJ1ZSkNCiAgICBleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgICAgIHN5cy5zdGRlcnIud3JpdGUoIkVycm9yOiAiICsNCiAgICAgICAgICAgICJZb3UgbXVzdCBhZGQgb3JnLnB5dGhvbi5weWRldi5kZWJ1Zy5weXNyYyB0byB5b3VyIFBZVEhPTlBBVEguIikNCiAgICAgICAgc3lzLmV4aXQoMSkNCg0KDQphZGRvbiA9IHhibWNhZGRvbi5BZGRvbigncGx1Z2luLnZpZGVvLmFuZHJvaWRyZXB1YmxpY2EnKQ0KYWRkb25fdmVyc2lvbiA9IGFkZG9uLmdldEFkZG9uSW5mbygndmVyc2lvbicpDQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkNCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQ0KZmF2b3JpdGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdmYXZvcml0ZXMnKQ0KaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpDQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQ0KaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQ0KRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykNCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKGhvbWUsICdzdWN1cmlfZmlsZScpDQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQ0KdGVzdCA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnY2FjaCcpDQpESUFMT0cgICAgICAgICA9IHhibWNndWkuRGlhbG9nKCkNCkFERE9OX0lEICAgICAgID0geGJtY2FkZG9uLkFkZG9uKCkuZ2V0QWRkb25JbmZvKCdpZCcpDQpjb21tdW5pdHlmaWxlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnTGl2ZXdlYlRWJykNCmRvd25sb2FkZXIgPSBkb3dubG9hZGVyLlNpbXBsZURvd25sb2FkZXIoKQ0KZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpDQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOg0KICAgIEZBViA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkNCmVsc2U6IEZBViA9IFtdDQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgU09VUkNFUyA9IG9wZW4oc291cmNlX2ZpbGUpLnJlYWQoKQ0KZWxzZTogU09VUkNFUyA9IFtdDQoNCmRlZiBnZXRLZXlib2FyZCggZGVmYXVsdD0iIiwgaGVhZGluZz0iIiwgaGlkZGVuPUZhbHNlICk6DQoJa2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKCBkZWZhdWx0LCBoZWFkaW5nLCBoaWRkZW4gKQ0KCWtleWJvYXJkLmRvTW9kYWwoKQ0KCWlmIGtleWJvYXJkLmlzQ29uZmlybWVkKCk6DQoJCXJldHVybiB1bmljb2RlKCBrZXlib2FyZC5nZXRUZXh0KCksICJ1dGYtOCIgKQ0KCXJldHVybiBkZWZhdWx0DQoNCmRlZiBhZGRvbl9sb2coc3RyaW5nKToNCiAgICBpZiBkZWJ1ZyA9PSAndHJ1ZSc6DQogICAgICAgIHhibWMubG9nKCJbYWRkb24uYW5kcm9pZHJlcHVibGljYS0lc106ICVzIiAlKGFkZG9uX3ZlcnNpb24sIHN0cmluZykpDQoNCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6DQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1BZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzUyLjAuMjc0My4xMTYgU2FmYXJpLzUzNy4zNid9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAnfCcgaW4gdXJsOg0KICAgICAgICAgICAgICAgIHVybCxoZWFkZXJfaW5fcGFnZT11cmwuc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPWhlYWRlcl9pbl9wYWdlLnNwbGl0KCcmJykNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGguc3BsaXQoJz0nKSk9PTI6DQogICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICB2YWxzPWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbj12YWxzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICB2PSc9Jy5qb2luKHZhbHNbMTpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI24sdj1oLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgbix2DQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbbl09dg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwsTm9uZSxoZWFkZXJzKQ0KICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6DQogICAgICAgICAgICBhZGRvbl9sb2coJ1VSTDogJyt1cmwpDQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihBbmRyb2lkcmVwdWJsaWNhLFdlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAiK3N0cihlLmNvZGUpKyIsMTAwMDAsIitpY29uKyIpIikNCiAgICAgICAgICAgIGVsaWYgaGFzYXR0cihlLCAncmVhc29uJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuJykNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1JlYXNvbjogJXMnICVlLnJlYXNvbikNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihBbmRyb2lkcmVwdWJsaWNhLFdlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4gLSAiK3N0cihlLnJlYXNvbikrIiwxMDAwMCwiK2ljb24rIikiKQ0KDQpkZWYgaW5kZXgoKToNCiAgICAgICAgdnBpbiA9IGFkZG9uLmdldFNldHRpbmcoJ3ZwaW4nKQ0KDQogICAgICAgIHVybCA9ICdodHRwczovL2FuZHJvaWRyZXB1YmxpY2EuY29tL3Bpbi1hZGRvbi8nDQogICAgICAgIHNlc3Npb24gPSByZXF1ZXN0cy5zZXNzaW9uKCkNCiAgICAgICAgaGVhZGVycyA9IHsnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NDsgcnY6NDcuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC80Ny4wJywNCgkJCSAgICdSZWZlcmVyJzogJyd9DQogICAgICAgIHIgPSBzZXNzaW9uLmdldCh1cmwsICBoZWFkZXJzPWhlYWRlcnMpLnRleHQgOyAjIHByaW50IHINCiAgICAgICAgdnBvc3QgPSByZS5maW5kYWxsKCcoP3MpY29udGVudD0iUGluIEFkZG9uLio/Y29udGVudD0iKC4qPykiJywgcilbMF0NCg0KICAgICAgICBpZiB2cGluID09ICcnIG9yIHZwaW4gIT0gdnBvc3Q6DQogICAgICAgICAgICAgICAgRElBTE9HLm9rKEFERE9OX0lELCAiW0NPTE9SIGN5YW5dU2lsYSBkYXBhdGthbiBwaW4gc2VjYXJhIHBlcmN1bWEgZGlbL0NPTE9SXVtDT0xPUiBsaW1lXSBodHRwOi8vYml0Lmx5L2FkZG9ucGluIFsvQ09MT1JdIikNCg0KICAgICAgICAgICAgICAgIG1lc3MxID0gJ1BpbiBqdWdhIGJvbGVoIGRpIGRhcGF0aSBkaSBbQ09MT1IgbGltZV1GYWNlYm9vayBQYWdlIEFuZHJvaWRyZXB1YmxpY2FbL0NPTE9SXScNCiAgICAgICAgICAgICAgICB2bWVzczEgPSBnZXRLZXlib2FyZCggZGVmYXVsdCA9ICIiLCBoZWFkaW5nID0gbWVzczEsIGhpZGRlbj1GYWxzZSkNCiAgICAgICAgICAgICAgICBpZiB2cG9zdCA9PSB2bWVzczEgOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkb24uc2V0U2V0dGluZygndnBpbicsIHZtZXNzMSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgICAgICAgICAgZWxzZSA6DQogICAgICAgICAgICAgICAgICAgICAgICBESUFMT0cubm90aWZpY2F0aW9uKEFERE9OX0lELCAiW0NPTE9SICVzXVNhbGFoIFBpbiBDb2RlIHR1IEJvc3NrdXUuIEN1YmEgTGFnaVsvQ09MT1JdIiAlICgnY3lhbicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3lzLmV4aXQoKQ0KICAgIA0KICAgICAgICBlbHNlIDoNCg0KICAgICAgICAgICAgICAgIHJldHVybiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQoNCmRlZiBnZXRTb3VyY2VzKCk6DQogICAgICAgIGluZGV4KCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKSA9PSBUcnVlOg0KICAgICAgICAgICAgICAgIGFkZERpcignRmF2b3JpdGVzJywndXJsJyw0LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgYWRkRGlyKCdYTUwgRGF0YWJhc2UnLCdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJywxNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV9jb21tdW5pdHkiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNob3RoZXJwbHVnaW5zIikgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgIGFkZERpcignU2VhcmNoIE90aGVyIFBsdWdpbnMnLCdTZWFyY2ggUGx1Z2lucycsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ3NvdXJjZXMnLHNvdXJjZXMNCiAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzb3VyY2VzOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMjIGZvciBwcmUgMS4wLjggc291cmNlcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaSwgbGlzdCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaWNvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ3RodW1ibmFpbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpWyd0aHVtYm5haWwnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gaVsnZmFuYXJ0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkZXNjcmlwdGlvbicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGlbJ2Rlc2NyaXB0aW9uJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkYXRlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaVsnZGF0ZSddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZ2VucmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gaVsnZ2VucmUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2NyZWRpdHMnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBpWydjcmVkaXRzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKGlbJ3RpdGxlJ10uZW5jb2RlKCd1dGYtOCcpLGlbJ3VybCddLmVuY29kZSgndXRmLTgnKSwxLHRodW1iLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cywnc291cmNlJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID09IDE6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbMF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsxXS5lbmNvZGUoJ3V0Zi04JyksRkFOQVJUKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bJ3VybCddLCBzb3VyY2VzWzBdWydmYW5hcnQnXSkNCiAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCg0KZGVmIGFkZFNvdXJjZSh1cmw9Tm9uZSk6DQogICAgICAgIGlmIHVybCBpcyBOb25lOg0KICAgICAgICAgICAgaWYgbm90IGFkZG9uLmdldFNldHRpbmcoIm5ld19maWxlX3NvdXJjZSIpID09ICIiOg0KICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQ0KICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X3VybF9zb3VyY2UiKSA9PSAiIjoNCiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc291cmNlX3VybCA9IHVybA0KICAgICAgICBpZiBzb3VyY2VfdXJsID09ICcnIG9yIHNvdXJjZV91cmwgaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBhZGRvbl9sb2coJ0FkZGluZyBOZXcgU291cmNlOiAnK3NvdXJjZV91cmwuZW5jb2RlKCd1dGYtOCcpKQ0KDQogICAgICAgIG1lZGlhX2luZm8gPSBOb25lDQogICAgICAgICNwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybA0KICAgICAgICBkYXRhID0gZ2V0U291cChzb3VyY2VfdXJsKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsQmVhdXRpZnVsU09BUCk6DQogICAgICAgICAgICBpZiBkYXRhLmZpbmQoJ2NoYW5uZWxzX2luZm8nKToNCiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5jaGFubmVsc19pbmZvDQogICAgICAgICAgICBlbGlmIGRhdGEuZmluZCgnaXRlbXNfaW5mbycpOg0KICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLml0ZW1zX2luZm8NCiAgICAgICAgaWYgbWVkaWFfaW5mbzoNCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9DQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybA0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBtZWRpYV9pbmZvLnRpdGxlLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGh1bWJuYWlsJ10gPSBtZWRpYV9pbmZvLnRodW1ibmFpbC5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gbWVkaWFfaW5mby5mYW5hcnQuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydnZW5yZSddID0gbWVkaWFfaW5mby5nZW5yZS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2Rlc2NyaXB0aW9uJ10gPSBtZWRpYV9pbmZvLmRlc2NyaXB0aW9uLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGF0ZSddID0gbWVkaWFfaW5mby5kYXRlLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnY3JlZGl0cyddID0gbWVkaWFfaW5mby5jcmVkaXRzLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBpZiAnLycgaW4gc291cmNlX3VybDoNCiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnLycpWy0xXS5zcGxpdCgnLicpWzBdDQogICAgICAgICAgICBpZiAnXFwnIGluIHNvdXJjZV91cmw6DQogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJ1xcJylbLTFdLnNwbGl0KCcuJylbMF0NCiAgICAgICAgICAgIGlmICclJyBpbiBuYW1lU3RyOg0KICAgICAgICAgICAgICAgIG5hbWVTdHIgPSB1cmxsaWIudW5xdW90ZV9wbHVzKG5hbWVTdHIpDQogICAgICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQobmFtZVN0ciwnRGlzcGxheWVkIE5hbWUsIFJlbmFtZT8nKQ0KICAgICAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpDQogICAgICAgICAgICBpZiAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBuZXdTdHIgPSBrZXlib2FyZC5nZXRUZXh0KCkNCiAgICAgICAgICAgIGlmIGxlbihuZXdTdHIpID09IDA6DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQ0KICAgICAgICAgICAgc291cmNlX21lZGlhWyd0aXRsZSddID0gbmV3U3RyDQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybA0KICAgICAgICAgICAgc291cmNlX21lZGlhWydmYW5hcnQnXSA9IGZhbmFydA0KDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09RmFsc2U6DQogICAgICAgICAgICBzb3VyY2VfbGlzdCA9IFtdDQogICAgICAgICAgICBzb3VyY2VfbGlzdC5hcHBlbmQoc291cmNlX21lZGlhKQ0KICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZV9saXN0KSkNCiAgICAgICAgICAgIGIuY2xvc2UoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkNCiAgICAgICAgICAgIHNvdXJjZXMuYXBwZW5kKHNvdXJjZV9tZWRpYSkNCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikNCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgIGIuY2xvc2UoKQ0KICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScsICIiKQ0KICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnLCAiIikNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oQW5kcm9pZHJlcHVibGljYSxOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpDQogICAgICAgIGlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQ0KICAgICAgICAgICAgZWxpZiAnY29tbXVuaXR5LWxpbmtzJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkNCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkNCg0KZGVmIHJtU291cmNlKG5hbWUpOg0KICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToNCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWzBdID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQ0KDQpkZWYgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIGJyb3dzZT1GYWxzZSk6DQogICAgICAgIGlmIHVybCBpcyBOb25lOg0KICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nDQogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpDQogICAgICAgIGZvciBpIGluIHNvdXAoJ2EnKToNCiAgICAgICAgICAgIGhyZWYgPSBpWydocmVmJ10NCiAgICAgICAgICAgIGlmIG5vdCBocmVmLnN0YXJ0c3dpdGgoJz8nKToNCiAgICAgICAgICAgICAgICBuYW1lID0gaS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBuYW1lIG5vdCBpbiBbJ1BhcmVudCBEaXJlY3RvcnknLCAncmVjeWNsZV9iaW4vJ106DQogICAgICAgICAgICAgICAgICAgIGlmIGhyZWYuZW5kc3dpdGgoJy8nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNSxpY29uLGZhbmFydCwnJywnJywnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTQsaWNvbixmYW5hcnQsJycsJycsJycpDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaHJlZi5lbmRzd2l0aCgnLnhtbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lIGluIFNPVVJDRVM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnIChpbiB1c2UpJyx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KDQpkZWYgZ2V0Q29tbXVuaXR5U291cmNlcyhicm93c2U9RmFsc2UpOg0KICAgICAgICB1cmwgPSAnaHR0cDovL2NvbW11bml0eS1saW5rcy5nb29nbGVjb2RlLmNvbS9zdm4vdHJ1bmsvJw0KICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQ0KICAgICAgICBmaWxlcyA9IHNvdXAoJ3VsJylbMF0oJ2xpJylbMTpdDQogICAgICAgIGZvciBpIGluIGZpbGVzOg0KICAgICAgICAgICAgbmFtZSA9IGkoJ2EnKVswXVsnaHJlZiddDQogICAgICAgICAgICBpZiBicm93c2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KDQpkZWYgZ2V0U291cCh1cmwsZGF0YT1Ob25lKToNCiAgICAgICAgZ2xvYmFsIHZpZXdtb2RlLHRzZG93bmxvYWRlciwgaGxzcmV0cnkNCiAgICAgICAgdHNkb3dubG9hZGVyPUZhbHNlDQogICAgICAgIGhsc3JldHJ5PUZhbHNlDQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCdodHRwOi8vJykgb3IgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6DQogICAgICAgICAgICBlbmNrZXk9RmFsc2UNCiAgICAgICAgICAgIGlmICckJFRTRE9XTkxPQURFUiQkJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgdHNkb3dubG9hZGVyPVRydWUNCiAgICAgICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoIiQkVFNET1dOTE9BREVSJCQiLCIiKQ0KICAgICAgICAgICAgaWYgJyQkSExTUkVUUlkkJCcgaW4gdXJsOg0KICAgICAgICAgICAgICAgIGhsc3JldHJ5PVRydWUNCiAgICAgICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoIiQkSExTUkVUUlkkJCIsIiIpDQogICAgICAgICAgICBpZiAnJCRMU1Byb0VuY0tleT0nIGluIHVybDoNCiAgICAgICAgICAgICAgICBlbmNrZXk9dXJsLnNwbGl0KCckJExTUHJvRW5jS2V5PScpWzFdLnNwbGl0KCckJCcpWzBdDQogICAgICAgICAgICAgICAgcnA9JyQkTFNQcm9FbmNLZXk9JXMkJCclZW5ja2V5DQogICAgICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKHJwLCIiKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZGF0YSA9bWFrZVJlcXVlc3QodXJsKQ0KICAgICAgICAgICAgaWYgZW5ja2V5Og0KICAgICAgICAgICAgICAgICAgICBpbXBvcnQgcHlhZXMNCiAgICAgICAgICAgICAgICAgICAgZW5ja2V5PWVuY2tleS5lbmNvZGUoImFzY2lpIikNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgZW5ja2V5DQogICAgICAgICAgICAgICAgICAgIG1pc3NpbmdieXRlcz0xNi1sZW4oZW5ja2V5KQ0KICAgICAgICAgICAgICAgICAgICBlbmNrZXk9ZW5ja2V5KyhjaHIoMCkqKG1pc3NpbmdieXRlcykpDQogICAgICAgICAgICAgICAgICAgIHByaW50IHJlcHIoZW5ja2V5KQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPWJhc2U2NC5iNjRkZWNvZGUoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdG9yID0gcHlhZXMubmV3KGVuY2tleSAsIHB5YWVzLk1PREVfRUNCLCBJVj1Ob25lKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPWRlY3J5cHRvci5kZWNyeXB0KGRhdGEpLnNwbGl0KCdcMCcpWzBdDQogICAgICAgICAgICAgICAgICAgICNwcmludCByZXByKGRhdGEpDQogICAgICAgICAgICBpZiByZS5zZWFyY2goIiNFWFRNM1UiLGRhdGEpIG9yICdtM3UnIGluIHVybDoNCiMgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJw0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgIGVsaWYgZGF0YSA9PSBOb25lOg0KICAgICAgICAgICAgaWYgbm90ICcvJyAgaW4gdXJsIG9yIG5vdCAnXFwnIGluIHVybDoNCiMgICAgICAgICAgICAgICAgcHJpbnQgJ05vIGRpcmVjdG9yeSBmb3VuZC4gTGV0cyBtYWtlIHRoZSB1cmwgdG8gY2FjaGUgZGlyJw0KICAgICAgICAgICAgICAgIHVybCA9IG9zLnBhdGguam9pbihjb21tdW5pdHlmaWxlcyx1cmwpDQogICAgICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyh1cmwpOg0KICAgICAgICAgICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCJzbWI6Ly8iKSBvciB1cmwuc3RhcnRzd2l0aCgibmZzOi8vIik6DQogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB4Ym1jdmZzLmNvcHkodXJsLCBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgY29weToNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpLCAiciIpLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3Zmcy5kZWxldGUob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coImZhaWxlZCB0byBjb3B5IGZyb20gc21iOiIpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4odXJsLCAncicpLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaCgiI0VYVE0zVSIsZGF0YSlvciAnbTN1JyBpbiB1cmw6DQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCJTb3VwIERhdGEgbm90IGZvdW5kISIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGlmICc8U2V0Vmlld01vZGU+JyBpbiBkYXRhOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHZpZXdtb2RlPXJlLmZpbmRhbGwoJzxTZXRWaWV3TW9kZT4oLio/KTwnLGRhdGEpWzBdDQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKCVzKSIldmlld21vZGUpDQogICAgICAgICAgICAgICAgcHJpbnQgJ2RvbmUgc2V0dmlldycsdmlld21vZGUNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICByZXR1cm4gQmVhdXRpZnVsU09BUChkYXRhLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU3RvbmVTb3VwLlhNTF9FTlRJVElFUykNCg0KZGVmIHByb2Nlc3NQeUZ1bmN0aW9uKGRhdGEpOg0KICAgIHRyeToNCiAgICAgICAgaWYgZGF0YSBhbmQgbGVuKGRhdGEpPjAgYW5kIGRhdGEuc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6DQogICAgICAgICAgICBkYXRhPWRvRXZhbChkYXRhLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxOb25lLE5vbmUgKQ0KICAgIGV4Y2VwdDogcGFzcw0KDQogICAgcmV0dXJuIGRhdGENCg0KZGVmIGdldERhdGEodXJsLGZhbmFydCwgZGF0YT1Ob25lKToNCg0KICAgIHNvdXAgPSBnZXRTb3VwKHVybCxkYXRhKQ0KICAgICNwcmludCB0eXBlKHNvdXApDQogICAgaWYgaXNpbnN0YW5jZShzb3VwLEJlYXV0aWZ1bFNPQVApOg0KICAgICNwcmludCAneHh4eHh4eHh4eHNvdXAnLHNvdXANCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMCBhbmQgYWRkb24uZ2V0U2V0dGluZygnZG9ub3RzaG93YnljaGFubmVscycpID09ICdmYWxzZSc6DQogICAgICAgICAgICBjaGFubmVscyA9IHNvdXAoJ2NoYW5uZWwnKQ0KICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbHM6DQojICAgICAgICAgICAgICAgIHByaW50IGNoYW5uZWwNCg0KICAgICAgICAgICAgICAgIGxpbmtlZFVybD0nJw0KICAgICAgICAgICAgICAgIGxjb3VudD0wDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBsaW5rZWRVcmwgPSAgY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGxjb3VudD1sZW4oY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJykpDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICAgICAgI3ByaW50ICdsaW5rZWRVcmwnLGxpbmtlZFVybCxsY291bnQNCiAgICAgICAgICAgICAgICBpZiBsY291bnQ+MTogbGlua2VkVXJsPScnDQoNCiAgICAgICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgbmFtZT1wcm9jZXNzUHlGdW5jdGlvbihuYW1lKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgICAgICAgICB0aHVtYm5haWw9cHJvY2Vzc1B5RnVuY3Rpb24odGh1bWJuYWlsKQ0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwyLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rZWRVcmwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IGZyb20gZ2V0RGF0YSgpOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZygnTm8gQ2hhbm5lbHM6IGdldEl0ZW1zJykNCiAgICAgICAgICAgIGdldEl0ZW1zKHNvdXAoJ2l0ZW0nKSxmYW5hcnQpDQogICAgZWxzZToNCiAgICAgICAgcGFyc2VfbTN1KHNvdXApDQoNCiMgYm9ycm93IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VuZW45Mi9QMlAtU3RyZWFtcy1YQk1DL2Jsb2IvbWFzdGVyL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy9yZXNvdXJjZXMvY29yZS9saXZlc3RyZWFtcy5weQ0KIyBUaGlzIHdpbGwgbm90IGdvIHRocm91Z2ggdGhlIGdldEl0ZW1zIGZ1bmN0aW9ucyAoIG1lYW5zIHlvdSBtdXN0IGhhdmUgcmVhZHkgdG8gcGxheSB1cmwsIG5vIHJlZ2V4KQ0KZGVmIHBhcnNlX20zdShkYXRhKToNCiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQ0KICAgIG1hdGNoID0gcmUuY29tcGlsZShyJyNFWFRJTkY6KC4rPyksKC4qPylbXG5ccl0rKFteXHJcbl0rKScpLmZpbmRhbGwoY29udGVudCkNCiAgICB0b3RhbCA9IGxlbihtYXRjaCkNCiAgICBwcmludCAndHNkb3dubG9hZGVyJyx0c2Rvd25sb2FkZXINCiMgICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwNCiAgICBmb3Igb3RoZXIsY2hhbm5lbF9uYW1lLHN0cmVhbV91cmwgaW4gbWF0Y2g6DQogICAgICAgIA0KICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOg0KICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVfbWUob3RoZXIsJ3R2Zy1sb2dvPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiB0aHVtYm5haWw6DQogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsDQoNCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoNCiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQ0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBsb2dvX3VybCArIHRodW1ibmFpbA0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsDQogICAgICAgICAgICAjZWxzZToNCg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoNCiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gc3RyZWFtX3VybCArIiZtb2RlPTE4Ig0KICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoNCiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpDQogICAgICAgICAgICAgICAgI3ByaW50IHVybFswXSBnZXRTb3VwKHVybCxkYXRhPU5vbmUpDQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpDQoNCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ2Z0dic6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUoY2hhbm5lbF9uYW1lKSArJyZ1cmw9JyArc3RyZWFtX3VybCArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnDQogICAgICAgIGVsaWYgdHNkb3dubG9hZGVyIGFuZCAnLnRzJyBpbiBzdHJlYW1fdXJsOg0KICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHJlYW1fdXJsKSsnJmFtcDtzdHJlYW10eXBlPVRTRE9XTkxPQURFUiZuYW1lPScrdXJsbGliLnF1b3RlKGNoYW5uZWxfbmFtZSkNCiAgICAgICAgZWxpZiBobHNyZXRyeSBhbmQgJy5tM3U4JyBpbiBzdHJlYW1fdXJsOg0KICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHJlYW1fdXJsKSsnJmFtcDtzdHJlYW10eXBlPUhMU1JFVFJZJm5hbWU9Jyt1cmxsaWIucXVvdGUoY2hhbm5lbF9uYW1lKQ0KICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkNCg0KZGVmIGdldENoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOg0KICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpDQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pDQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdpdGVtJykNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbF9saXN0KCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsX2xpc3QoJ3N1YmNoYW5uZWwnKToNCiAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgbmFtZT1wcm9jZXNzUHlGdW5jdGlvbihuYW1lKQ0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgdGh1bWJuYWlsPXByb2Nlc3NQeUZ1bmN0aW9uKHRodW1ibmFpbCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxjcmVkaXRzLGRhdGUpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuQXJ0KQ0KDQpkZWYgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6DQogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkNCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdzdWJjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkNCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ3N1Yml0ZW0nKQ0KICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpDQoNCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQsZG9udExpbms9RmFsc2UpOg0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkNCiAgICAgICAgYWRkX3BsYXlsaXN0ID0gYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykNCiAgICAgICAgYXNrX3BsYXlsaXN0X2l0ZW1zID1hZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKQ0KICAgICAgICB1c2VfdGh1bWIgPSBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSINCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6DQogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQ0KICAgICAgICAgICAgaXNKc29ucnBjID0gRmFsc2UNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYXBwbHlibG9jaz0nZmFsc2UnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgYXBwbHlibG9jayA9IGl0ZW0oJ3BhcmVudGFsYmxvY2snKVswXS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3BhcmVudGFsYmxvY2sgRXJyb3InKQ0KICAgICAgICAgICAgICAgIGFwcGx5YmxvY2sgPSAnJw0KICAgICAgICAgICAgaWYgYXBwbHlibG9jaz09J3RydWUnIGFuZCBwYXJlbnRhbGJsb2NrOiBjb250aW51ZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIG5hbWUgaXMgTm9uZToNCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICd1bmtub3duPycNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIG5hbWU9cHJvY2Vzc1B5RnVuY3Rpb24obmFtZSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ05hbWUgRXJyb3InKQ0KICAgICAgICAgICAgICAgIG5hbWUgPSAnJw0KDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToNCiAgICAgICAgICAgICAgICAgICAgaWYgaXRlbS5lcGdfdXJsOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdHZXQgRVBHIFJlZ2V4JykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfcmVnZXggPSBpdGVtLmVwZ19yZWdleC5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19uYW1lID0gZ2V0X2VwZyhlcGdfdXJsLCBlcGdfcmVnZXgpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9ICcgLSAnICsgZXBnX25hbWUNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpdGVtKCdlcGcnKVswXS5zdHJpbmcgPiAxOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0VQRyBFcnJvcicpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdXJsID0gW10NCiAgICAgICAgICAgICAgICBpZiBsZW4oaXRlbSgnbGluaycpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdpdGVtIGxpbmsnLCBpdGVtKCdsaW5rJykNCg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdsaW5rJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGkuc3RyaW5nKQ0KDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnc3BvcnRzZGV2aWwnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3Nwb3J0c2RldmlsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwvP21vZGU9MSZhbXA7aXRlbT1jYXRjaGVyJTNkc3RyZWFtcyUyNnVybD0nICtpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZXIgPSBpdGVtKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVmZXJlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZWZlcmVyIGZvdW5kJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9IHNwb3J0c2RldmlsICsgJyUyNnJlZmVyZXI9JyArcmVmZXJlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc3BvcnRzZGV2aWwpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgncDJwJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdwMnAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzb3A6Ly8nIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3AgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz9tb2RlPTJ1cmw9JytpLnN0cmluZyArJyYnICsgJ25hbWU9JytuYW1lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc29wKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAycD0ncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz9tb2RlPTEmdXJsPScraS5zdHJpbmcgKycmJyArICduYW1lPScrbmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHAycCkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd2YXVnaG4nKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3ZhdWdobicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1Z2huID0gJ3BsdWdpbjovL3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50di8/bW9kZT1QbGF5TGl2ZVN0cmVhbSZhbXA7Y2hhbm5lbD0nK2kuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh2YXVnaG4pDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaWxpdmUnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2lsaXZlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgJ2h0dHAnIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9aHR0cDovL3d3dy5zdHJlYW1saXZlLnRvL3ZpZXcvJytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9JytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd5dC1kbCcpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgneXQtZGwnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZGwgPSBpLnN0cmluZyArICcmbW9kZT0xOCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHl0ZGwpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZG0nKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2RtJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbSA9ICJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZGFpbHltb3Rpb25fY29tLz9tb2RlPXBsYXlWaWRlbyZ1cmw9IiArIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdkbWxpdmUnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2RtbGl2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5TGl2ZVZpZGVvJnVybD0iICsgaS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGRtKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1dHViZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyAnIGluIGkuc3RyaW5nIDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvc2VhcmNoLz9xPScrIHVybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGxlbihpLnN0cmluZykgPT0gMTE6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScrIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAoaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBhbmQgbm90ICcmb3JkZXI9JyBpbiBpLnN0cmluZykgb3IgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVVUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3BsYXlsaXN0X2lkPScgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbGVuKGkuc3RyaW5nKSA+IDEyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9jaGFubmVsLycgKyBpLnN0cmluZyArICcvJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBpLnN0cmluZy5zdGFydHN3aXRoKCdVQycpIGFuZCBub3QgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykpICA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3VzZXIvJyArIGkuc3RyaW5nICsgJy8nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSnNvbnJwYz11dHViZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh1dHViZSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbWRiJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbWRiJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdnZW5lc2lzb3JwdWxzYXInKSA9PSAnMCc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1wbGF5JmltZGI9JytpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS90dCcraS5zdHJpbmcrJy9wbGF5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaW1kYikNCg0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Y0bScpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnLmY0bScgaW4gaS5zdHJpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICcubTN1OCcgaW4gaS5zdHJpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykrJyZhbXA7c3RyZWFtdHlwZT1ITFMnDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJw0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmNG0pICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Z0dicpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZnR2Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdHYgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKG5hbWUpICsnJnVybD0nICtpLnN0cmluZyArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGZ0dikNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1cmxzb2x2ZScpKSA+MDogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1cmxzb2x2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBpLnN0cmluZyArJyZtb2RlPTE5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocmVzb2x2ZXIpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaW5wdXRzdHJlYW0nKSkgPjA6ICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW5wdXRzdHJlYW0nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzdHJlYW0gPSBpLnN0cmluZyArJyZtb2RlPTIwJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaXN0cmVhbSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdzbHByb3h5JykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzbHByb3h5Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc3RyZWFtID0gaS5zdHJpbmcgKycmbW9kZT0yMicNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGlzdHJlYW0pICAgICAgIA0KDQogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPCAxOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFcnJvciA8bGluaz4gZWxlbWVudCwgUGFzc2luZzonK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlID0gaXRlbSgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCg0KICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6DQogICAgICAgICAgICAgICAgZXh0X3VybD1baXNYTUxTb3VyY2VdDQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9VHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYyA9IGl0ZW0oJ2pzb25ycGMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgaWYgaXNKc29ucnBjOg0KDQogICAgICAgICAgICAgICAgZXh0X3VybD1baXNKc29ucnBjXQ0KICAgICAgICAgICAgICAgICNwcmludCAnSlNPTi1SUEMgZXh0X3VybCcsZXh0X3VybA0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1UcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1GYWxzZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGl0ZW0oJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIHRodW1ibmFpbD1wcm9jZXNzUHlGdW5jdGlvbih0aHVtYm5haWwpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBub3QgaXRlbSgnZmFuYXJ0Jyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaXRlbSgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGVzYyA9IGl0ZW0oJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGVzYyA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBnZW5yZSA9IGl0ZW0oJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkYXRlID0gaXRlbSgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkYXRlID0gJycNCg0KICAgICAgICAgICAgcmVnZXhzID0gTm9uZQ0KICAgICAgICAgICAgaWYgaXRlbSgncmVnZXgnKToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHJlZ19pdGVtID0gaXRlbSgncmVnZXgnKQ0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChyZWdfaXRlbSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA+IDE6DQogICAgICAgICAgICAgICAgICAgIGFsdCA9IDANCiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QgPSBbXQ0KICAgICAgICAgICAgICAgICAgICBpZ25vcmVsaXN0c2V0dGluZz1UcnVlIGlmICckJExTUGxheU9ubHlPbmUkJCcgaW4gdXJsWzBdIGVsc2UgRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAgYWRkX3BsYXlsaXN0ID09ICJmYWxzZSIgYW5kIG5vdCBpZ25vcmVsaXN0c2V0dGluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0ICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhpLCclcykgJXMnICUoYWx0LCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIChhZGRfcGxheWxpc3QgPT0gInRydWUiIGFuZCAgYXNrX3BsYXlsaXN0X2l0ZW1zID09ICd0cnVlJykgb3IgaWdub3JlbGlzdHNldHRpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmcmVnZXhzPScrcmVnZXhzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICBhbnkoeCBpbiBpIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIGkuc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZtb2RlPTE5JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBsYXlsaXN0KSA+IDE6ICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgZG9udExpbms6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSx1cmxbMF0scmVnZXhzDQogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHMgPT0gTm9uZTogIzxleHRlcm5hbGxpbms+IGFuZCA8cmVnZXg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJyEhdXBkYXRlJyxyZWdleHMsdXJsWzBdLmVuY29kZSgndXRmLTgnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2FkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSsgICdbQ09MT1IgeWVsbG93XWJ1aWxkIFhNTFsvQ09MT1JdJyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScsTm9uZSxOb25lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gbmFtZSBhbmQgbm90IGdldFJlZ2V4UGFyc2VkPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG5hbWUsc2V0cmVzPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0bmFtZT09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9dG5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gdGh1bWJuYWlsIGFuZCBub3QgZ2V0UmVnZXhQYXJzZWQ9PU5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRuYW1lLHNldHJlcz1nZXRSZWdleFBhcnNlZChyZWdleHMsIHRodW1ibmFpbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRuYW1lPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsPXRuYW1lDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQoNCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9DQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25hbWUnXT1pKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmVzJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXT0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlcmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm9yZWRpcmVjdCddID0gaSgnbm9yZWRpcmVjdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBvcmlnaW4gLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWNjZXB0J10gPSBpKCdhY2NlcHQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBhY2NlcHQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaW5jbHVkZWhlYWRlcnMnXSA9IGkoJ2luY2x1ZGVoZWFkZXJzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydsaXN0cmVwZWF0J10gPSBpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdsaXN0cmVwZWF0JyxyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2xpc3RyZXBlYXQnXSxpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nLCBpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbGlzdHJlcGVhdCAtLSIpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwcm94eSddID0gaSgncHJveHknKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBwcm94eSAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtYWRkciddID0gaSgneC1hZGRyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1hZGRyIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWZvcndhcmQnXSA9IGkoJ3gtZm9yd2FyZCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncG9zdCddID0gaSgncG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJhd3Bvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddPScnDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgc2V0Y29va2llIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikNCg0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzDQogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbg0KZGVmIGdldF91c3RyZWFtKHVybCk6DQogICAgdHJ5Og0KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6DQogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQ0KICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybA0KICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuDQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApDQogICAgICAgIHJldHVybg0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuDQoNCmRlZiBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCxjb29raWVKYXI9Tm9uZSxmb3JDb29raWVKYXJPbmx5PUZhbHNlLHJlY3Vyc2l2ZUNhbGw9RmFsc2UsY2FjaGVkUGFnZXM9e30sIHJhd1Bvc3Q9RmFsc2UsIGNvb2tpZV9qYXJfZmlsZT1Ob25lKTojMCwxLDIgPSBVUkwsIHJlZ2V4T25seSwgQ29va2llSmFyT25seQ0KICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoNCiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkNCiAgICAgICAgI2NhY2hlZFBhZ2VzID0ge30NCiAgICAgICAgI3ByaW50ICd1cmwnLHVybA0KICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQ0KIyAgICAgICAgcHJpbnQgJ2RvUmVnZXhzJyxkb1JlZ2V4cyxyZWdleHMNCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQ0KICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoNCiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOg0KICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrDQogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQ0KICAgICAgICAgICAgICAgICNwcmludCBtDQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZWphciBleGlzdHMnLG1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnY29va2llamFyJ10sY29va2llSmFyLFRydWUsIFRydWUsY2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ21bY29va2llamFyXScsbVsnY29va2llamFyJ10sY29va2llSmFyDQogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY3JlYXRlIGNvb2tpZSBqYXInDQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ29wZW5bJylbMV0uc3BsaXQoJ10nKVswXQ0KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29va2llSmFyIGZyb20gZmlsZSBuYW1lJyxjb29raWVfamFyX2ZpbGUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Nvb2tpZUphciBmcm9tIGZpbGUnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliDQogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphciBuZXcnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106DQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgcGc9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBnKT09MDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBnPSdodHRwOi8vcmVnZXhmYWlsZWQnDQogICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1wZw0KDQogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106DQogICAgICAgICAgICAgICAgICAgIG1bJ3NldGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnc2V0Y29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpDQogICAgICAgICAgICAgICAgICAgICNwcmludCAncmF3cG9zdCBpcyBub3cnLG1bJ3Jhd3Bvc3QnXQ0KDQogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUkJyBpbiBtWydyYXdwb3N0J106DQogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkNCg0KICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCg0KICAgICAgICAgICAgICAgIGxpbms9JycNCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VzaW5nIGNhY2hlIHBhZ2UnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVybD1wYWdlX3NwbGl0WzBdDQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1wYWdlX3NwbGl0WzFdDQoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAoJ2h0dHBzJyA/IHByb3h5dG91c2VbOjVdPT0iaHR0cHMiOiJodHRwIikgOiBwcm94eXRvdXNlfSkNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICANCiMgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdXJsbGliMg0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmxsaWIyLmdldHByb3hpZXMnLHVybGxpYjIuZ2V0cHJveGllcygpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Byb3hpZXM9dXJsbGliMi5Qcm94eUhhbmRsZXIodXJsbGliMi5nZXRwcm94aWVzKCkpDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZ2V0dGluZyBwYWdlVXJsJyxwYWdlVXJsDQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwcm94eScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPSBtWydwcm94eSddDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdwcm94eXRvdXNlJyxwcm94eXRvdXNlDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuZ2V0cHJveGllcz0gbGFtYmRhOiB7fQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2VVcmxbOjVdPT0iaHR0cHMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgJ2h0dHBzJyA6IHByb3h5dG91c2V9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cHMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAnaHR0cCcgIDogcHJveHl0b3VzZX0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZXEuc2V0X3Byb3h5KHByb3h5dG91c2UsICdodHRwJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihwcm94eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPU5vbmUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3JlZmVyZXInIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWNjZXB0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdBY2NlcHQnLCBtWydhY2NlcHQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtYWRkcicgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcigneC1hZGRyJywgbVsneC1hZGRyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhcHBlbmRpbmcgY29va2llIHRvIGNvb2tpZWphcicsbVsnYXBwZW5kY29va2llJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPWNvb2tpZXN0b0FwZW5kLnNwbGl0KCc7JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBjb29raWVzdG9BcGVuZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LG49IG4uc3BsaXQoJzonKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjayA9IGNvb2tpZWxpYi5Db29raWUodmVyc2lvbj0wLCBuYW1lPW4sIHZhbHVlPXYsIHBvcnQ9Tm9uZSwgcG9ydF9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbj13LCBkb21haW5fc3BlY2lmaWVkPUZhbHNlLCBkb21haW5faW5pdGlhbF9kb3Q9RmFsc2UsIHBhdGg9Jy8nLCBwYXRoX3NwZWNpZmllZD1UcnVlLCBzZWN1cmU9RmFsc2UsIGV4cGlyZXM9Tm9uZSwgZGlzY2FyZD1UcnVlLCBjb21tZW50PU5vbmUsIGNvbW1lbnRfdXJsPU5vbmUsIHJlc3Q9eydIdHRwT25seSc6IE5vbmV9LCByZmMyMTA5PUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ09yaWdpbicsIG1bJ29yaWdpbiddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoLnNwbGl0KCc9Jyk9PTI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxzPWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj12YWxzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PSc9Jy5qb2luKHZhbHNbMTpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcihuLHYpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb29raWVKYXI9PU5vbmU6DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdub3JlZGlyZWN0Jywnbm9yZWRpcmVjdCcgaW4gbQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlcixOb1JlZGlyZWN0aW9uLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29ubmVjdGlvbicgaW4gbToNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20ga2VlcGFsaXZlIGltcG9ydCBIVFRQSGFuZGxlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnYWZ0ZXIgY29va2llIGphcicNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncG9zdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0RGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQsaWRmaWVsZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10sY29va2llSmFyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgcG9zdERhdGE9cG9zdERhdGEucmVwbGFjZSgnJExpdmVTdHJlYW1SZWNhcHRjaGEnLCdtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkKycsaWQ6JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0cG9zdD1wb3N0RGF0YS5zcGxpdCgnLCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD17fQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIHNwbGl0cG9zdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj1wLnNwbGl0KCc6JylbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdj1wLnNwbGl0KCc6JylbMV0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IHVybGxpYi51cmxlbmNvZGUocG9zdCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1tWydyYXdwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCxpZGZpZWxkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSxjb29raWVKYXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgICAgIHBvc3Q9cG9zdC5yZXBsYWNlKCckTGl2ZVN0cmVhbVJlY2FwdGNoYScsJyZtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkKycmaWQ9JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGluaz0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5pbmZvKCkuZ2V0KCdDb250ZW50LUVuY29kaW5nJykgPT0gJ2d6aXAnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIFN0cmluZ0lPIGltcG9ydCBTdHJpbmdJTw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgZ3ppcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYgPSBTdHJpbmdJTyggcmVzcG9uc2UucmVhZCgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZ3ppcC5HemlwRmlsZShmaWxlb2JqPWJ1ZikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IGYucmVhZCgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtIGFuZCBub3QgY3VycmVudF9wcm94aWVzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIodXJsbGliMi5idWlsZF9vcGVuZXIoY3VycmVudF9wcm94aWVzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCByZXByKGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsgVGhpcyBqdXN0IHByaW50IHdob2xlIHdlYnBhZ2UgaW4gTE9HDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbGluays9c3RyKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdTZXQtQ29va2llJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfU1RBUlQkJDonDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBiIGluIHJlc3BvbnNlLmhlYWRlcnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0gYisnOicrcmVzcG9uc2UuaGVhZGVycy5nZXQoYikrJ1xuJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0nJCRIRUFERVJTX0VORCQkOicNCiAgICAjICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhjb29raWVKYXIgKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIsbSApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10NCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgaW4gbVsnZXhwcmVzJ10gb3IgJ0FjdGl2YXRlV2luZG93JyAgaW4gbVsnZXhwcmVzJ10gb3IgJ1J1blBsdWdpbicgIGluIG1bJ2V4cHJlcyddICBvciAnJFBMQVlFUlBST1hZJD0nIGluIHVybCAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToNCiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmVzJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZXMnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlcyddPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlcyddOg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXJsIGFuZCB2YWwnLHVybCx2YWwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KDQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jykgb3IgJyMkcHlGdW5jdGlvbicgaW4gbVsnZXhwcmVzJ106DQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ2V4cHJlcyddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmVzJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyLG0pDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWxGdW5jdGlvbihtWydleHByZXMnXSxsaW5rLGNvb2tpZUphcixtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZXMnXSBvciAnUnVuUGx1Z2luJyBpbiBtWydleHByZXMnXSAgOiByZXR1cm4gJycsRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2xpc3RyZXBlYXQnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdD1tWydsaXN0cmVwZWF0J10gICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JldD1yZS5maW5kYWxsKG1bJ2V4cHJlcyddLGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZXQnLHZhbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaXN0cmVwZWF0LGV2YWwodmFsKSwgbSxyZWdleHMsY29va2llSmFyDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3JlcHInLHJlcHIodmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UodSIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbC5kZWNvZGUoInV0Zi04IikpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0PW1bJ2xpc3RyZXBlYXQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGlzdHJlcGVhdCcsbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FhYWEnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQ9cmUuZmluZGFsbChtWydleHByZXMnXSxsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmV0JyxyZXQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdHJlcGVhdCxyZXQsIG0scmVnZXhzLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGluaycsbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmVzJ10pLnNlYXJjaChsaW5rKSAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZWcuZ3JvdXAoMSkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXT09Jycgb3IgbVsncGFnZSddPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1tWydleHByZXMnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsLmRlY29kZSgidXRmLTgiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXInLHVybA0KICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsJycpDQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgaWYgJyRHVUlEJCcgaW4gdXJsOg0KICAgICAgICAgICAgaW1wb3J0IHV1aWQNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQ0KICAgICAgICBpZiAnJGdldF9jb29raWVzJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpDQoNCiAgICAgICAgaWYgcmVjdXJzaXZlQ2FsbDogcmV0dXJuIHVybA0KICAgICAgICAjcHJpbnQgJ2ZpbmFsIHVybCcscmVwcih1cmwpDQogICAgICAgIGlmIHVybD09IiI6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiB1cmwsc2V0cmVzb2x2ZWQNCg0KZGVmIGdldG1kNSh0KToNCiAgICBpbXBvcnQgaGFzaGxpYg0KICAgIGg9aGFzaGxpYi5tZDUoKQ0KICAgIGgudXBkYXRlKHQpDQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkNCg0KZGVmIGRlY3J5cHRfdmF1Z2hubGl2ZShlbmNyeXB0ZWQpOg0KICAgIHJldFZhbD0iIg0KIyAgICBwcmludCAnZW5jJyxlbmNyeXB0ZWQNCiAgICAjZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToNCiAgICAjICAgIHJldFZhbCs9Y2hyKGludCh2YWwucmVwbGFjZSgiMG0wIiwiIikpKQ0KICAgICNyZXR1cm4gcmV0VmFsDQoNCmRlZiBwbGF5bWVkaWEobWVkaWFfdXJsKToNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyDQogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQ0KICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSAiRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQ0KICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQ0KICAgICAgICB4Ym1jLnNsZWVwKDEwMDApDQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkNCiAgICBleGNlcHQ6DQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQ0KICAgIHJldHVybiAnJw0KDQpkZWYga29kaUpzb25SZXF1ZXN0KHBhcmFtcyk6DQogICAgZGF0YSA9IGpzb24uZHVtcHMocGFyYW1zKQ0KICAgIHJlcXVlc3QgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKGRhdGEpDQoNCiAgICB0cnk6DQogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXF1ZXN0KQ0KICAgIGV4Y2VwdCBVbmljb2RlRGVjb2RlRXJyb3I6DQogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXF1ZXN0LmRlY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQoNCiAgICB0cnk6DQogICAgICAgIGlmICdyZXN1bHQnIGluIHJlc3BvbnNlOg0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWydyZXN1bHQnXQ0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIGV4Y2VwdCBLZXlFcnJvcjoNCiAgICAgICAgbG9nZ2VyLndhcm4oIlslc10gJXMiICUgKHBhcmFtc1snbWV0aG9kJ10sIHJlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ10pKQ0KICAgICAgICByZXR1cm4gTm9uZQ0KDQpkZWYgc2V0S29kaVByb3h5KHByb3h5c2V0dGluZ3M9Tm9uZSk6DQoNCiAgICBpZiBwcm94eXNldHRpbmdzPT1Ob25lOg0KIyAgICAgICAgcHJpbnQgJ3Byb3h5IHNldCB0byBub3RoaW5nJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOmZhbHNlfSwgImlkIjoxfScpDQogICAgZWxzZToNCiAgICAgICAgDQogICAgICAgIHBzPXByb3h5c2V0dGluZ3Muc3BsaXQoJzonKQ0KICAgICAgICBwcm94eVVSTD1wc1swXQ0KICAgICAgICBwcm94eVBvcnQ9cHNbMV0NCiAgICAgICAgcHJveHlUeXBlPXBzWzJdDQogICAgICAgIHByb3h5VXNlcm5hbWU9Tm9uZQ0KICAgICAgICBwcm94eVBhc3N3b3JkPU5vbmUNCiAgICAgICAgDQogICAgICAgIGlmIGxlbihwcyk+MyBhbmQgJ0AnIGluIHBzWzNdOiAjamFpcm94ICMjI3Byb3h5c2V0dGluZ3MNCiAgICAgICAgICAgIHByb3h5VXNlcm5hbWU9cHNbM10uc3BsaXQoJ0AnKVswXSAjamFpcm94ICMjI3BzWzNdDQogICAgICAgICAgICBwcm94eVBhc3N3b3JkPXBzWzNdLnNwbGl0KCdAJylbMV0gI2phaXJveCAjIyNwcm94eXNldHRpbmdzLnNwbGl0KCdAJylbLTFdDQoNCiMgICAgICAgIHByaW50ICdwcm94eSBzZXQgdG8nLCBwcm94eVR5cGUsIHByb3h5VVJMLHByb3h5UG9ydA0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOnRydWV9LCAiaWQiOjF9JykNCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dHlwZSIsICJ2YWx1ZSI6JyArIHN0cihwcm94eVR5cGUpICsnfSwgImlkIjoxfScpDQogICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXNlcnZlciIsICJ2YWx1ZSI6IicgKyBzdHIocHJveHlVUkwpICsnIn0sICJpZCI6MX0nKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0IiwgInZhbHVlIjonICsgc3RyKHByb3h5UG9ydCkgKyd9LCAiaWQiOjF9JykNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHJveHlVc2VybmFtZT09Tm9uZToNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVVzZXJuYW1lKSArJyJ9LCAiaWQiOjF9JykNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXBhc3N3b3JkIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVBhc3N3b3JkKSArJyJ9LCAiaWQiOjF9JykNCiAgICAgICANCmRlZiBnZXRDb25maWd1cmVkUHJveHkoKToNCiAgICBwcm94eUFjdGl2ZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5In0sICdpZCc6IDF9KVsndmFsdWUnXQ0KIyAgICBwcmludCAncHJveHlBY3RpdmUnLHByb3h5QWN0aXZlDQogICAgcHJveHlUeXBlID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KDQogICAgaWYgcHJveHlBY3RpdmU6ICMgUFJPWFlfSFRUUA0KICAgICAgICBwcm94eVVSTCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBvcnQgPSB1bmljb2RlKGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cG9ydCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10pDQogICAgICAgIHByb3h5VXNlcm5hbWUgPSBrb2RpSnNvblJlcXVlc3Qoeydqc29ucnBjJzogJzIuMCcsICJtZXRob2QiOiJTZXR0aW5ncy5HZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBhc3N3b3JkID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10NCg0KICAgICAgICBpZiBwcm94eVVzZXJuYW1lIGFuZCBwcm94eVBhc3N3b3JkIGFuZCBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpICsgJzonICsgcHJveHlVc2VybmFtZSArICdAJyArIHByb3h5UGFzc3dvcmQNCiAgICAgICAgZWxpZiBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQpkZWYgcGxheW1lZGlhd2l0aHByb3h5KG1lZGlhX3VybCwgbmFtZSwgaWNvbkltYWdlLHByb3h5aXAscG9ydCwgcHJveHl1c2VyPU5vbmUsIHByb3h5cGFzcz1Ob25lKTogI2phaXJveA0KDQogICAgaWYgbWVkaWFfdXJsPT1Ob25lIG9yIG1lZGlhX3VybD09Jyc6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EsVW5hYmxlIHRvIHBsYXkgZW1wdHkgVXJsLDUwMDAsIitpY29uKyIpIikNCiAgICAgICAgcmV0dXJuDQogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkNCiAgICBwcm9ncmVzcy5jcmVhdGUoJ1Byb2dyZXNzJywgJ1BsYXlpbmcgd2l0aCBjdXN0b20gcHJveHknKQ0KICAgIHByb2dyZXNzLnVwZGF0ZSggMTAsICIiLCAic2V0dGluZyBwcm94eS4uIiwgIiIgKQ0KICAgIHByb3h5c2V0PUZhbHNlDQogICAgZXhpc3RpbmdfcHJveHk9JycNCiAgICAjcHJpbnQgJ3BsYXltZWRpYXdpdGhwcm94eScNCiAgICB0cnk6DQogICAgICAgIA0KICAgICAgICBleGlzdGluZ19wcm94eT1nZXRDb25maWd1cmVkUHJveHkoKQ0KICAgICAgICBwcmludCAnZXhpc3RpbmdfcHJveHknLGV4aXN0aW5nX3Byb3h5DQogICAgICAgICNyZWFkIGFuZCBzZXQgaGVyZQ0KICAgICAgICAjamFpcm94DQogICAgICAgIGlmIG5vdCBwcm94eXVzZXIgPT0gTm9uZToNCiAgICAgICAgICAgIHNldEtvZGlQcm94eSggcHJveHlpcCArICc6JyArIHBvcnQgKyAnOjA6JyArIHByb3h5dXNlciArICdAJyArIHByb3h5cGFzcykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNldEtvZGlQcm94eSggcHJveHlpcCArICc6JyArIHBvcnQgKyAnOjAnKQ0KDQogICAgICAgIHByaW50ICdwcm94eSBzZXR0aW5nIGNvbXBsZXRlIHBsYXlpbmcnLG1lZGlhX3VybA0KICAgICAgICBwcm94eXNldD1UcnVlDQogICAgICAgIHByb2dyZXNzLnVwZGF0ZSggODAsICIiLCAic2V0dGluZyBwcm94eSBjb21wbGV0ZSwgbm93IHBsYXlpbmciLCAiIiApDQogICAgICAgIA0KDQogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyDQogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQ0KICAgICAgICBwbGF5ZXIucGRpYWxvZ3VlPT1wcm9ncmVzcw0KICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSBpY29uSW1hZ2UsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQ0KICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQ0KICAgICAgICB4Ym1jLnNsZWVwKDEwMDApDQogICAgICAgICN3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOg0KICAgICAgICAjICAgIHhibWMuc2xlZXAoMjAwKQ0KICAgICAgICBpbXBvcnQgdGltZQ0KICAgICAgICBiZWZvcmVzdGFydD10aW1lLnRpbWUoKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOg0KICAgICAgICAgICAgICAgIHhibWMuc2xlZXAoMTAwMCkgICAgICAgDQogICAgICAgICAgICAgICAgaWYgcGxheWVyLnVybHBsYXllZD09RmFsc2UgYW5kIHRpbWUudGltZSgpLWJlZm9yZXN0YXJ0PjEyOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAnZmFpbGVkISEhJw0KICAgICAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihBbmRyb2lkcmVwdWJsaWNhLFVuYWJsZSB0byBwbGF5IGNoZWNrIHByb3h5LDUwMDAsIitpY29uKyIpIikNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAjeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICBleGNlcHQ6IHBhc3MNCg0KICAgICAgICBwcm9ncmVzcy5jbG9zZSgpDQogICAgICAgIHByb2dyZXNzPU5vbmUNCiAgICBleGNlcHQ6DQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQ0KICAgIGlmIHByb2dyZXNzOg0KICAgICAgICBwcm9ncmVzcy5jbG9zZSgpDQogICAgaWYgcHJveHlzZXQ6DQogICAgICAgIHByaW50ICdub3cgcmVzZXR0aW5nIHRoZSBwcm94eSBiYWNrJw0KICAgICAgICBzZXRLb2RpUHJveHkoZXhpc3RpbmdfcHJveHkpDQogICAgICAgIHByaW50ICdyZXNldCBoZXJlJw0KICAgIHJldHVybiAnJw0KDQpkZWYgZ2V0X3Nhd19ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6DQogICAgaWYgcmVmZXJlcjoNCiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0NCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgcGFnZV91cmw9cGFnZV92YWx1ZQ0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpDQoNCiAgICBzdHJfcGF0dGVybj0iKGV2YWxcKGZ1bmN0aW9uXChwLGEsYyxrLGUsKD86cnxkKS4qKSINCg0KICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKQ0KICAgIHI9IiINCiAgICBpZiByZWdfcmVzIGFuZCBsZW4ocmVnX3Jlcyk+MDoNCiAgICAgICAgZm9yIHYgaW4gcmVnX3JlczoNCiAgICAgICAgICAgIHIxPWdldF91bnBhY2tlZCh2KQ0KICAgICAgICAgICAgcjI9cmVfbWUocjEsJ1wnKC4qPylcJycpDQogICAgICAgICAgICBpZiAndW5lc2NhcGUnIGluIHIxOg0KICAgICAgICAgICAgICAgIHIxPXVybGxpYi51bnF1b3RlKHIyKQ0KICAgICAgICAgICAgcis9cjErJ1xuJw0KIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHZhbHVlIGlzICcscg0KDQogICAgICAgIHBhZ2VfdXJsPXJlX21lKHIsJ3NyYz0iKC4qPykiJykNCg0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV91cmwsaGVhZGVycz1yZWZlcmVyKQ0KDQogICAgI3ByaW50IHBhZ2VfdmFsdWUNCg0KICAgIHJ0bXA9cmVfbWUocGFnZV92YWx1ZSwnc3RyZWFtZXJcJy4qP1wnKC4qPylcJ1wpJykNCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQ0KDQoNCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsDQoNCmRlZiBnZXRfbGV0b25fcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOg0KICAgIGlmIHJlZmVyZXI6DQogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildDQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikNCiAgICBzdHJfcGF0dGVybj0idmFyIGEgPSAoLio/KTtccyp2YXIgYiA9ICguKj8pO1xzKnZhciBjID0gKC4qPyk7XHMqdmFyIGQgPSAoLio/KTtccyp2YXIgZiA9ICguKj8pO1xzKnZhciB2X3BhcnQgPSAnKC4qPyknOyINCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0NCg0KICAgIGEsYixjLGQsZix2PShyZWdfcmVzKQ0KICAgIGY9aW50KGYpDQogICAgYT1pbnQoYSkvZg0KICAgIGI9aW50KGIpL2YNCiAgICBjPWludChjKS9mDQogICAgZD1pbnQoZCkvZg0KDQogICAgcmV0PSAncnRtcDovLycgKyBzdHIoYSkgKyAnLicgKyBzdHIoYikgKyAnLicgKyBzdHIoYykgKyAnLicgKyBzdHIoZCkgKyB2DQogICAgcmV0dXJuIHJldA0KDQpkZWYgY3JlYXRlTTN1Rm9yRGFzaCh1cmwsdXNlcmFnZW50PU5vbmUpOg0KICAgIHN0cj0nI0VYVE0zVScNCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2Jw0KICAgIHN0cis9J1xuJyt1cmwrJyZieXRlcz0wLTIwMDAwMCcjKyd8VXNlci1BZ2VudD0nK3VzZXJhZ2VudA0KICAgIHNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZXN0ZmlsZS5tM3UnKQ0KICAgIHN0cis9J1xuJw0KICAgIFNhdmVUb0ZpbGUoc291cmNlX2ZpbGUsc3RyKQ0KICAgICNyZXR1cm4gJ0M6L1VzZXJzL3NoYW5pL0Rvd25sb2Fkcy90ZXN0Lm0zdTgnDQogICAgcmV0dXJuIHNvdXJjZV9maWxlDQoNCmRlZiBTYXZlVG9GaWxlKGZpbGVfbmFtZSxwYWdlX2RhdGEsYXBwZW5kPUZhbHNlKToNCiAgICBpZiBhcHBlbmQ6DQogICAgICAgIGYgPSBvcGVuKGZpbGVfbmFtZSwgJ2EnKQ0KICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkNCiAgICAgICAgZi5jbG9zZSgpDQogICAgZWxzZToNCiAgICAgICAgZj1vcGVuKGZpbGVfbmFtZSwnd2InKQ0KICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkNCiAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIHJldHVybiAnJw0KDQpkZWYgTG9hZEZpbGUoZmlsZV9uYW1lKToNCiAgICBmPW9wZW4oZmlsZV9uYW1lLCdyYicpDQogICAgZD1mLnJlYWQoKQ0KICAgIGYuY2xvc2UoKQ0KICAgIHJldHVybiBkDQoNCmRlZiBnZXRfcGFja2VkX2lwaG9uZXR2X3VybChwYWdlX2RhdGEpOg0KICAgIGltcG9ydCByZSxiYXNlNjQsdXJsbGliDQogICAgcz1wYWdlX2RhdGENCiAgICB3aGlsZSAnZ2VoKCcgaW4gczoNCiAgICAgICAgaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXQ0KIyAgICAgICBwcmludCAncyBpcyAnLHMNCiAgICAgICAgcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXQ0KICAgICAgICBzPSAgYmFzZTY0LmI2NGRlY29kZShzKQ0KICAgICAgICBzPXVybGxpYi51bnF1b3RlKHMpDQogICAgcHJpbnQgcw0KICAgIHJldHVybiBzDQoNCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToNCiMgICAgcHJpbnQgJ2dldF9kYWdfdXJsMicscGFnZV9kYXRhDQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKQ0KICAgIHBhdHQ9JyhodHRwLiopJw0KICAgIGltcG9ydCB1dWlkDQogICAgcGxheWJhY2s9c3RyKHV1aWQudXVpZDEoKSkudXBwZXIoKQ0KICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQ0KICAgIGhlYWRlcnM9WygnWC1QbGF5YmFjay1TZXNzaW9uLUlkJyxwbGF5YmFjayldDQogICAgZm9yIGwgaW4gbGlua3M6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwYWdlX2RhdGF0ZW1wPWdldFVybChsLGhlYWRlcnM9aGVhZGVycykNCg0KICAgICAgICBleGNlcHQ6IHBhc3MNCg0KICAgIHJldHVybiBwYWdlX2RhdGErJ3wmWC1QbGF5YmFjay1TZXNzaW9uLUlkPScrcGxheWJhY2sNCg0KZGVmIGdldF9kYWdfdXJsKHBhZ2VfZGF0YSk6DQojICAgIHByaW50ICdnZXRfZGFnX3VybCcscGFnZV9kYXRhDQogICAgaWYgcGFnZV9kYXRhLnN0YXJ0c3dpdGgoJ2h0dHA6Ly9kYWcudG90YWwtc3RyZWFtLm5ldCcpOg0KICAgICAgICBoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdWZXJpc21vLUJsYWNrVUlfKDIuNC43LjUuOC4wLjM0KScpXQ0KICAgICAgICBwYWdlX2RhdGE9Z2V0VXJsKHBhZ2VfZGF0YSxoZWFkZXJzPWhlYWRlcnMpDQoNCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6DQogICAgICAgIHJldHVybiByZXZpc3RfZGFnKHBhZ2VfZGF0YSkNCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykNCiAgICBlbHNlOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdocmVmPSIoW14iXSspIlteIl0rJCcpDQogICAgICAgIGlmIGxlbihmaW5hbF91cmwpPT0wOg0KICAgICAgICAgICAgZmluYWxfdXJsPXBhZ2VfZGF0YQ0KICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCcgJywgJyUyMCcpDQogICAgcmV0dXJuIGZpbmFsX3VybA0KDQpkZWYgcmVfbWUoZGF0YSwgcmVfcGF0dGVuKToNCiAgICBtYXRjaCA9ICcnDQogICAgbSA9IHJlLnNlYXJjaChyZV9wYXR0ZW4sIGRhdGEpDQogICAgaWYgbSAhPSBOb25lOg0KICAgICAgICBtYXRjaCA9IG0uZ3JvdXAoMSkNCiAgICBlbHNlOg0KICAgICAgICBtYXRjaCA9ICcnDQogICAgcmV0dXJuIG1hdGNoDQoNCmRlZiByZXZpc3RfZGFnKHBhZ2VfZGF0YSk6DQogICAgZmluYWxfdXJsID0gJycNCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJyBsaXZlPXRydWUgdGltZW91dD0xNSBwbGF5cGF0aD0nICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW2EtekEtWjAtOS1fXFwuQF0rKScpDQoNCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwgKyAnP3Rva2VuPScgKyByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpDQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpDQogICAgZWxzZToNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnSFJFRj0iKFteIl0rKSInKQ0KDQogICAgaWYgJ2RhZzEuYXN4JyBpbiBmaW5hbF91cmw6DQogICAgICAgIHJldHVybiBnZXRfZGFnX3VybChmaW5hbF91cmwpDQoNCiAgICBpZiAnZGV2aW5saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoNCiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ2RldmlubGl2ZScsICdmbGl2ZScpDQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoNCiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ3Blcm1saXZlJywgJ2ZsaXZlJykNCiAgICByZXR1cm4gZmluYWxfdXJsDQoNCmRlZiBnZXRfdW53aXNlKCBzdHJfZXZhbCk6DQogICAgcGFnZV92YWx1ZT0iIg0KICAgIHRyeToNCiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknDQogICAgICAgIGV4ZWMgKHNzKQ0KICAgICAgICBwYWdlX3ZhbHVlPXVud2lzZV9mdW5jKHcsaSxzLGUpDQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiAgICAjcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgcmV0dXJuIHBhZ2VfdmFsdWUNCg0KZGVmIHVud2lzZV9mdW5jKCB3LCBpLCBzLCBlKToNCiAgICBsSWxsID0gMA0KICAgIGxsMUkgPSAwDQogICAgSWwxbCA9IDANCiAgICBsbDFsID0gW10NCiAgICBsMWxJID0gW10NCiAgICB3aGlsZSBUcnVlOg0KICAgICAgICBpZiAobElsbCA8IDUpOg0KICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkNCiAgICAgICAgZWxpZiAobElsbCA8IGxlbih3KSk6DQogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKQ0KICAgICAgICBsSWxsKz0xDQogICAgICAgIGlmIChsbDFJIDwgNSk6DQogICAgICAgICAgICBsMWxJLmFwcGVuZChpW2xsMUldKQ0KICAgICAgICBlbGlmIChsbDFJIDwgbGVuKGkpKToNCiAgICAgICAgICAgIGxsMWwuYXBwZW5kKGlbbGwxSV0pDQogICAgICAgIGxsMUkrPTENCiAgICAgICAgaWYgKElsMWwgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHNbSWwxbF0pDQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSkNCiAgICAgICAgSWwxbCs9MQ0KICAgICAgICBpZiAobGVuKHcpICsgbGVuKGkpICsgbGVuKHMpICsgbGVuKGUpID09IGxlbihsbDFsKSArIGxlbihsMWxJKSArIGxlbihlKSk6DQogICAgICAgICAgICBicmVhaw0KDQogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOw0KICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsNCiAgICBsbDFJID0gMA0KICAgIGwxbGwgPSBbXQ0KICAgIGZvciBsSWxsIGluIHJhbmdlKDAsbGVuKGxsMWwpLDIpOg0KICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpDQogICAgICAgIGxsMTEgPSAtMQ0KICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOg0KICAgICAgICAgICAgbGwxMSA9IDENCiAgICAgICAgI3ByaW50ICd2YWwgaXMgJywgbEkxbFtsSWxsOiBsSWxsKzJdDQogICAgICAgIGwxbGwuYXBwZW5kKGNociggICAgaW50KGxJMWxbbElsbDogbElsbCsyXSwgMzYpIC0gbGwxMSkpDQogICAgICAgIGxsMUkrPTENCiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToNCiAgICAgICAgICAgIGxsMUkgPSAwDQogICAgcmV0PScnLmpvaW4obDFsbCkNCiAgICBpZiAnZXZhbChmdW5jdGlvbih3LGkscyxlKScgaW4gcmV0Og0KIyAgICAgICAgcHJpbnQgJ1NUSUxMIEdPaW5nJw0KICAgICAgICByZXQ9cmUuY29tcGlsZSgnZXZhbFwoZnVuY3Rpb25cKHcsaSxzLGVcKS4qfVwoKC4qPylcKScpLmZpbmRhbGwocmV0KVswXQ0KICAgICAgICByZXR1cm4gZ2V0X3Vud2lzZShyZXQpDQogICAgZWxzZToNCiMgICAgICAgIHByaW50ICdGSU5JU0hFRCcNCiAgICAgICAgcmV0dXJuIHJldA0KDQpkZWYgZ2V0X3VucGFja2VkKCBwYWdlX3ZhbHVlLCByZWdleF9mb3JfdGV4dD0nJywgaXRlcmF0aW9ucz0xLCB0b3RhbF9pdGVyYXRpb249MSk6DQogICAgdHJ5Og0KICAgICAgICByZWdfZGF0YT1Ob25lDQogICAgICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUpDQojICAgICAgICBwcmludCAncGFnZV92YWx1ZScscGFnZV92YWx1ZQ0KICAgICAgICBpZiByZWdleF9mb3JfdGV4dCBhbmQgbGVuKHJlZ2V4X2Zvcl90ZXh0KT4wOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHBhZ2VfdmFsdWU9cmUuY29tcGlsZShyZWdleF9mb3JfdGV4dCkuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAjZ2V0IHRoZSBqcyB2YXJpYWJsZQ0KICAgICAgICAgICAgZXhjZXB0OiByZXR1cm4gJ05PVFBBQ0tFRCcNCg0KICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFnZV92YWx1ZT0nVU5QQUNLRURGQUlMRUQnDQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KIyAgICBwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUNCiAgICBpZiAnc2F2MWxpdmUudHYnIGluIHBhZ2VfdmFsdWU6DQogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQ0KIyAgICAgICAgcHJpbnQgJ3NhdjEgdW5wYWNrZWQnLHBhZ2VfdmFsdWUNCiAgICByZXR1cm4gcGFnZV92YWx1ZQ0KDQpkZWYgdW5wYWNrKHNKYXZhc2NyaXB0LGl0ZXJhdGlvbj0xLCB0b3RhbGl0ZXJhdGlvbnM9MiAgKToNCiMgICAgcHJpbnQgJ2l0ZXJhdGlvbicsaXRlcmF0aW9uDQogICAgaWYgc0phdmFzY3JpcHQuc3RhcnRzd2l0aCgndmFyIF8weGNiOGE9Jyk6DQogICAgICAgIGFTcGxpdD1zSmF2YXNjcmlwdC5zcGxpdCgndmFyIF8weGNiOGE9JykNCiAgICAgICAgc3M9Im15YXJyYXk9IithU3BsaXRbMV0uc3BsaXQoImV2YWwoIilbMF0NCiAgICAgICAgZXhlYyhzcykNCiAgICAgICAgYTE9NjINCiAgICAgICAgYzE9aW50KGFTcGxpdFsxXS5zcGxpdCgiLDYyLCIpWzFdLnNwbGl0KCcsJylbMF0pDQogICAgICAgIHAxPW15YXJyYXlbMF0NCiAgICAgICAgazE9bXlhcnJheVszXQ0KICAgICAgICB3aXRoIG9wZW4oJ3RlbXAgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6DQogICAgICAgICAgICBmaWxld3JpdGVyLndyaXRlKHN0cihrMSkpDQogICAgICAgICNhYT0xLzANCiAgICBlbHNlOg0KDQogICAgICAgIGlmICJybiBwfSgnIiBpbiBzSmF2YXNjcmlwdDoNCiAgICAgICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBwfSgnIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBBfSgnIikNCiMgICAgICAgIHByaW50IGFTcGxpdA0KDQogICAgICAgIHAxLGExLGMxLGsxPSgnJywnMCcsJzAnLCcnKQ0KDQogICAgICAgIHNzPSJwMSxhMSxjMSxrMT0oJyIrYVNwbGl0WzFdLnNwbGl0KCIuc3BsaSIpWzBdKycpJw0KICAgICAgICBleGVjKHNzKQ0KICAgIGsxPWsxLnNwbGl0KCd8JykNCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpDQojICAgIHByaW50ICcgcCBhcnJheSBpcyAnLGxlbihhU3BsaXQpDQojICAgcHJpbnQgbGVuKGFTcGxpdCApDQoNCiAgICAjcD1zdHIoYVNwbGl0WzBdKycpKScpIy5yZXBsYWNlKCJcXCIsIiIpIy5yZXBsYWNlKCdcXFxcJywnXFwnKQ0KDQogICAgI3ByaW50IGFTcGxpdFsxXQ0KICAgICNhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIiwiKQ0KICAgICNwcmludCBhU3BsaXRbMF0NCiAgICAjYSA9IGludChhU3BsaXRbMV0pDQogICAgI2MgPSBpbnQoYVNwbGl0WzJdKQ0KICAgICNrID0gYVNwbGl0WzNdLnNwbGl0KCIuIilbMF0ucmVwbGFjZSgiJyIsICcnKS5zcGxpdCgnfCcpDQogICAgI2E9aW50KGEpDQogICAgI2M9aW50KGMpDQoNCiAgICAjcD1wLnJlcGxhY2UoJ1xcJywgJycpDQojICAgIHByaW50ICdwIHZhbCBpcyAnLHBbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHBbLTEwMDpdLGxlbihwKQ0KIyAgICBwcmludCAncDEgdmFsIGlzICcscDFbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHAxWy0xMDA6XSxsZW4ocDEpDQoNCiAgICAjcHJpbnQgYSxhMQ0KICAgICNwcmludCBjLGExDQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspDQojICAgIHByaW50ICdrMSB2YWwgaXMgJyxrMVstMTA6XSxsZW4oazEpDQogICAgZSA9ICcnDQogICAgZCA9ICcnIzMyODIzDQoNCiAgICAjc1VucGFja2VkID0gc3RyKF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQpKQ0KICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkNCg0KICAgICNwcmludCBzVW5wYWNrZWRbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZFstMTAwOl0sIGxlbihzVW5wYWNrZWQpDQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkNCg0KICAgICNleGVjKCdzVW5wYWNrZWQxPSInK3NVbnBhY2tlZDErJyInKQ0KICAgIGlmIGl0ZXJhdGlvbj49dG90YWxpdGVyYXRpb25zOg0KIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcycsc1VucGFja2VkMVs6MjAwXSsnLi4uLicrc1VucGFja2VkMVstMTAwOl0sIGxlbihzVW5wYWNrZWQxKQ0KICAgICAgICByZXR1cm4gc1VucGFja2VkMSMucmVwbGFjZSgnXFxcXCcsICdcXCcpDQogICAgZWxzZToNCiMgICAgICAgIHByaW50ICdmaW5hbCByZXMgZm9yIHRoaXMgaXRlcmF0aW9uIGlzJyxpdGVyYXRpb24NCiAgICAgICAgcmV0dXJuIHVucGFjayhzVW5wYWNrZWQxLGl0ZXJhdGlvbisxKSMucmVwbGFjZSgnXFwnLCAnJyksaXRlcmF0aW9uKSMucmVwbGFjZSgnXFwnLCAnJyk7I3VucGFjayhzVW5wYWNrZWQucmVwbGFjZSgnXFwnLCAnJykpDQoNCmRlZiBfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkLCBpdGVyYXRpb24sdj0xKToNCg0KICAgICN3aXRoIG9wZW4oJ2JlZm9yZSBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoNCiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQ0KICAgIHdoaWxlIChjID49IDEpOg0KICAgICAgICBjID0gYyAtMQ0KICAgICAgICBpZiAoa1tjXSk6DQogICAgICAgICAgICBhYT1zdHIoX19pdG9hTmV3KGMsIGEpKQ0KICAgICAgICAgICAgaWYgdj09MToNCiAgICAgICAgICAgICAgICBwPXJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkjIFRISVMgSVMgQmxvb2R5IHNsb3chDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHA9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkNCg0KICAgICAgICAgICAgI3A9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkNCg0KDQogICAgI3dpdGggb3BlbignYWZ0ZXIgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6DQogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkNCiAgICByZXR1cm4gcA0KDQojDQojZnVuY3Rpb24gZXF1YWxhdmVudCB0byByZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApDQpkZWYgZmluZEFuZFJlcGxhY2VXb3JkKHNvdXJjZV9zdHIsIHdvcmRfdG9fZmluZCxyZXBsYWNlX3dpdGgpOg0KICAgIHNwbGl0cz1Ob25lDQogICAgc3BsaXRzPXNvdXJjZV9zdHIuc3BsaXQod29yZF90b19maW5kKQ0KICAgIGlmIGxlbihzcGxpdHMpPjE6DQogICAgICAgIG5ld19zdHJpbmc9W10NCiAgICAgICAgY3VycmVudF9pbmRleD0wDQogICAgICAgIGZvciBjdXJyZW50X3NwbGl0IGluIHNwbGl0czoNCiAgICAgICAgICAgICNwcmludCAnaGVyZScsaQ0KICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQoY3VycmVudF9zcGxpdCkNCiAgICAgICAgICAgIHZhbD13b3JkX3RvX2ZpbmQjYnkgZGVmYXVsdCBhc3N1bWUgaXQgd2FzIHdyb25nIHRvIHNwbGl0DQoNCiAgICAgICAgICAgICNpZiBpdHMgZmlyc3Qgb25lIGFuZCBpdGVtIGlzIGJsYW5rIHRoZW4gY2hlY2sgbmV4dCBpdGVtIGlzIHZhbGlkIG9yIG5vdA0KICAgICAgICAgICAgaWYgY3VycmVudF9pbmRleD09bGVuKHNwbGl0cyktMToNCiAgICAgICAgICAgICAgICB2YWw9JycgIyBsYXN0IG9uZSBub3RoaW5nIHRvIGFwcGVuZCBub3JtYWxseQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpZiBsZW4oY3VycmVudF9zcGxpdCk9PTA6ICNpZiBibGFuayBjaGVjayBuZXh0IG9uZSB3aXRoIGN1cnJlbnQgc3BsaXQgdmFsdWUNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0DQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoDQogICAgICAgICAgICAgICAgI25vdCBibGFuaywgdGhlbiBjaGVjayBjdXJyZW50IGVuZHZhbHVlIGFuZCBuZXh0IGZpcnN0IHZhbHVlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0c1tjdXJyZW50X2luZGV4XVstMV0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBhbmQgKCggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgNCg0KICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQodmFsKQ0KICAgICAgICAgICAgY3VycmVudF9pbmRleCs9MQ0KICAgICAgICAjYWFhYT0xLzANCiAgICAgICAgc291cmNlX3N0cj0nJy5qb2luKG5ld19zdHJpbmcpDQogICAgcmV0dXJuIHNvdXJjZV9zdHINCg0KZGVmIF9faXRvYShudW0sIHJhZGl4KToNCiMgICAgcHJpbnQgJ251bSByZWQnLG51bSwgcmFkaXgNCiAgICByZXN1bHQgPSAiIg0KICAgIGlmIG51bT09MDogcmV0dXJuICcwJw0KICAgIHdoaWxlIG51bSA+IDA6DQogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdA0KICAgICAgICBudW0gLz0gcmFkaXgNCiAgICByZXR1cm4gcmVzdWx0DQoNCmRlZiBfX2l0b2FOZXcoY2MsIGEpOg0KICAgIGFhPSIiIGlmIGNjIDwgYSBlbHNlIF9faXRvYU5ldyhpbnQoY2MgLyBhKSxhKQ0KICAgIGNjID0gKGNjICUgYSkNCiAgICBiYj1jaHIoY2MgKyAyOSkgaWYgY2M+IDM1IGVsc2Ugc3RyKF9faXRvYShjYywzNikpDQogICAgcmV0dXJuIGFhK2JiDQoNCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6DQogICAgdHJ5Og0KICAgICAgICBjb29raWVTdHJpbmc9IiINCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6DQogICAgICAgICAgICBjb29raWVTdHJpbmcrPWNvb2tpZS5uYW1lICsgIj0iICsgY29va2llLnZhbHVlICsiOyINCiAgICBleGNlcHQ6IHBhc3MNCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nDQogICAgcmV0dXJuIGNvb2tpZVN0cmluZw0KDQpkZWYgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsQ09PS0lFRklMRSk6DQogICAgdHJ5Og0KICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpDQogICAgICAgIGNvb2tpZUphci5zYXZlKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkNCiAgICBleGNlcHQ6IHBhc3MNCg0KZGVmIGdldENvb2tpZUphcihDT09LSUVGSUxFKToNCg0KICAgIGNvb2tpZUphcj1Ob25lDQogICAgaWYgQ09PS0lFRklMRToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQ0KICAgICAgICAgICAgY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpDQogICAgICAgICAgICBjb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIGNvb2tpZUphcj1Ob25lDQoNCiAgICBpZiBub3QgY29va2llSmFyOg0KICAgICAgICBjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkNCg0KICAgIHJldHVybiBjb29raWVKYXINCg0KZGVmIGRvRXZhbChmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToNCiAgICByZXRfdmFsPScnDQogICAgI3ByaW50IGZ1bl9jYWxsDQogICAgaWYgZnVuY3Rpb25zX2RpciBub3QgaW4gc3lzLnBhdGg6DQogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQ0KDQojICAgIHByaW50IGZ1bl9jYWxsDQogICAgdHJ5Og0KICAgICAgICBweV9maWxlPSdpbXBvcnQgJytmdW5fY2FsbC5zcGxpdCgnLicpWzBdDQojICAgICAgICBwcmludCBweV9maWxlLHN5cy5wYXRoDQogICAgICAgIGV4ZWMoIHB5X2ZpbGUpDQojICAgICAgICBwcmludCAnZG9uZScNCiAgICBleGNlcHQ6DQogICAgICAgIHByaW50ICdkb0V2YWw6IGVycm9yIGluIGltcG9ydCcNCiAgICAgICAgI3RyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KIyAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsDQogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkNCiMgICBwcmludCByZXRfdmFsDQogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykNCiAgICB0cnk6DQogICAgICAgIHJldHVybiBzdHIocmV0X3ZhbCkNCiAgICBleGNlcHQ6IHJldHVybiByZXRfdmFsDQoNCmRlZiBkb0V2YWxGdW5jdGlvbihmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToNCiMgICAgcHJpbnQgJ2RvRXZhbEZ1bmN0aW9uJw0KICAgIHRyeToNCiAgICAgICAgZ2xvYmFsIGdMU1Byb0R5bmFtaWNDb2RlTnVtYmVyDQogICAgICAgIGdMU1Byb0R5bmFtaWNDb2RlTnVtYmVyPWdMU1Byb0R5bmFtaWNDb2RlTnVtYmVyKzENCiAgICAgICAgcmV0X3ZhbD0nJw0KICAgICAgICBwcmludCAnZG9vb29kb28nDQogICAgICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOg0KICAgICAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpDQoNCiAgICAgICAgZmlsZW5hbWU9J0xTUHJvZHluYW1pY0NvZGUlcy5weSclc3RyKGdMU1Byb0R5bmFtaWNDb2RlTnVtYmVyKQ0KICAgICAgICBmaWxlbmFtZXdpdGhwYXRoPW9zLnBhdGguam9pbihmdW5jdGlvbnNfZGlyLGZpbGVuYW1lKQ0KICAgICAgICBmPW9wZW4oZmlsZW5hbWV3aXRocGF0aCwid2IiKQ0KICAgICAgICBmLndyaXRlKCIjIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLVxuIikNCiAgICAgICAgZi53cml0ZShmdW5fY2FsbC5lbmNvZGUoInV0Zi04IikpDQogICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICBwcmludCAnYmVmb3JlIGRvJw0KICAgICAgICBMU1Byb2R5bmFtaWNDb2RlID0gaW1wb3J0X2J5X3N0cmluZyhmaWxlbmFtZS5zcGxpdCgnLicpWzBdLGZpbGVuYW1ld2l0aHBhdGgpDQogICAgICAgIHByaW50ICdhZnRlcicNCiAgICAgICAgIA0KICAgICAgICByZXRfdmFsPUxTUHJvZHluYW1pY0NvZGUuR2V0TFNQcm9EYXRhKHBhZ2VfZGF0YSxDb29raWVfSmFyLG0pDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJldHVybiBzdHIocmV0X3ZhbCkNCiAgICAgICAgZXhjZXB0OiByZXR1cm4gcmV0X3ZhbA0KICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgcmV0dXJuICIiDQoNCmRlZiBpbXBvcnRfYnlfc3RyaW5nKGZ1bGxfbmFtZSxmaWxlbmFtZXdpdGhwYXRoKToNCiAgICB0cnk6DQogICAgICAgIA0KICAgICAgICBpbXBvcnQgaW1wb3J0bGliDQogICAgICAgIHJldHVybiBpbXBvcnRsaWIuaW1wb3J0X21vZHVsZShmdWxsX25hbWUsIHBhY2thZ2U9Tm9uZSkNCiAgICBleGNlcHQ6DQogICAgICAgIGltcG9ydCBpbXANCiAgICAgICAgcmV0dXJuIGltcC5sb2FkX3NvdXJjZShmdWxsX25hbWUsZmlsZW5hbWV3aXRocGF0aCkNCg0KZGVmIGdldEdvb2dsZVJlY2FwdGNoYVJlc3BvbnNlKGNhcHRjaGFrZXksIGNqLHR5cGU9MSk6ICMxIGZvciBnZXQsIDIgZm9yIHBvc3QsIDMgZm9yIHJhd3Bvc3QNCiMgICAgI2hlYWRlcnM9WygnVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKV0NCiMgICAgaHRtbF90ZXh0PWdldFVybCh1cmwsbm9yZWRpcj1UcnVlLCBjb29raWVKYXI9Y2osaGVhZGVycz1oZWFkZXJzKQ0KICMgICBwcmludCAnaHRtbF90ZXh0JyxodG1sX3RleHQNCiAgICByZWNhcENoYWxsZW5nZT0iIg0KICAgIHNvbHV0aW9uPSIiDQojICAgIGNhcF9yZWc9InJlY2FwLio/XD9rPSguKj8pXCIiICAgIA0KIyAgICBtYXRjaCA9cmUuZmluZGFsbChjYXBfcmVnLCBodG1sX3RleHQpDQogICAgDQogICAgICAgIA0KIyAgICBwcmludCAnbWF0Y2gnLG1hdGNoDQogICAgY2FwdGNoYT1GYWxzZQ0KICAgIGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPU5vbmUNCiAgICBzb2x1dGlvbj1Ob25lDQogICAgaWYgbGVuKGNhcHRjaGFrZXkpPjA6ICNuZXcgc2hpbnkgY2FwdGNoYSENCiAgICAgICAgY2FwdGNoYV91cmw9Y2FwdGNoYWtleQ0KICAgICAgICBpZiBub3QgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgY2FwdGNoYV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL2NoYWxsZW5nZT9rPScrY2FwdGNoYV91cmwrJyZhamF4PTEnDQojICAgICAgICBwcmludCAnY2FwdGNoYV91cmwnLGNhcHRjaGFfdXJsDQogICAgICAgIGNhcHRjaGE9VHJ1ZQ0KDQogICAgICAgIGNhcF9jaGFsbF9yZWc9J2NoYWxsZW5nZS4qP1wnKC4qPylcJycNCiAgICAgICAgY2FwX2ltYWdlX3JlZz0nXCcoLio/KVwnJw0KICAgICAgICBjYXB0Y2hhX3NjcmlwdD1nZXRVcmwoY2FwdGNoYV91cmwsY29va2llSmFyPWNqKQ0KICAgICAgICByZWNhcENoYWxsZW5nZT1yZS5maW5kYWxsKGNhcF9jaGFsbF9yZWcsIGNhcHRjaGFfc2NyaXB0KVswXQ0KICAgICAgICBjYXB0Y2hhX3JlbG9hZD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvcmVsb2FkP2M9Jw0KICAgICAgICBjYXB0Y2hhX2s9Y2FwdGNoYV91cmwuc3BsaXQoJ2s9JylbMV0NCiAgICAgICAgY2FwdGNoYV9yZWxvYWQrPXJlY2FwQ2hhbGxlbmdlKycmaz0nK2NhcHRjaGFfaysnJnJlYXNvbj1pJnR5cGU9aW1hZ2UmbGFuZz1lbicNCiAgICAgICAgY2FwdGNoYV9yZWxvYWRfanM9Z2V0VXJsKGNhcHRjaGFfcmVsb2FkLGNvb2tpZUphcj1jaikNCiAgICAgICAgY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0NCiAgICAgICAgY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL2ltYWdlP2M9JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbA0KICAgICAgICBpZiBub3QgY2FwdGNoYV9pbWFnZV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICAgICAgY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwNCiAgICAgICAgaW1wb3J0IHJhbmRvbQ0KICAgICAgICBuPXJhbmRvbS5yYW5kcmFuZ2UoMTAwLDEwMDAsNSkNCiAgICAgICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApDQogICAgICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikNCiAgICAgICAgbG9jYWxGaWxlLndyaXRlKGdldFVybChjYXB0Y2hhX2ltYWdlX3VybCxjb29raWVKYXI9Y2opKQ0KICAgICAgICBsb2NhbEZpbGUuY2xvc2UoKQ0KICAgICAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpDQogICAgICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpDQogICAgICAgIG9zLnJlbW92ZShsb2NhbF9jYXB0Y2hhKQ0KDQogICAgaWYgY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw6DQogICAgICAgIGlmIHR5cGU9PTE6DQogICAgICAgICAgICByZXR1cm4gJ3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCkrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhzb2x1dGlvbikNCiAgICAgICAgZWxpZiB0eXBlPT0yOg0KICAgICAgICAgICAgcmV0dXJuICdyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkOicrY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwrJyxyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ6Jytzb2x1dGlvbg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuICdyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrdXJsbGliLnF1b3RlX3BsdXMoY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwpKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrdXJsbGliLnF1b3RlX3BsdXMoc29sdXRpb24pDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuICcnDQoNCmRlZiBnZXRVcmwodXJsLCBjb29raWVKYXI9Tm9uZSxwb3N0PU5vbmUsIHRpbWVvdXQ9MjAsIGhlYWRlcnM9Tm9uZSwgbm9yZWRpcj1GYWxzZSk6DQoNCg0KICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCg0KICAgIGlmIG5vcmVkaXI6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgIGVsc2U6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQ0KICAgIGlmIGhlYWRlcnM6DQogICAgICAgIGZvciBoLGh2IGluIGhlYWRlcnM6DQogICAgICAgICAgICByZXEuYWRkX2hlYWRlcihoLGh2KQ0KDQogICAgcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpDQogICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICByZXNwb25zZS5jbG9zZSgpDQogICAgcmV0dXJuIGxpbmsNCg0KZGVmIGdldF9kZWNvZGUoc3RyLHJlZz1Ob25lKToNCiAgICBpZiByZWc6DQogICAgICAgIHN0cj1yZS5maW5kYWxsKHJlZywgc3RyKVswXQ0KICAgIHMxID0gdXJsbGliLnVucXVvdGUoc3RyWzA6IGxlbihzdHIpLTFdKQ0KICAgIHQgPSAnJw0KICAgIGZvciBpIGluIHJhbmdlKCBsZW4oczEpKToNCiAgICAgICAgdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pDQogICAgdD11cmxsaWIudW5xdW90ZSh0KQ0KIyAgICBwcmludCB0DQogICAgcmV0dXJuIHQNCg0KZGVmIGphdmFzY3JpcHRVbkVzY2FwZShzdHIpOg0KICAgIGpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikNCiMgICAgcHJpbnQgJ2pzJyxqcw0KICAgIGlmIChub3QganM9PU5vbmUpIGFuZCBsZW4oanMpPjA6DQogICAgICAgIGZvciBqIGluIGpzOg0KICAgICAgICAgICAgI3ByaW50IHVybGxpYi51bnF1b3RlKGopDQogICAgICAgICAgICBzdHI9c3RyLnJlcGxhY2UoaiAsdXJsbGliLnVucXVvdGUoaikpDQogICAgcmV0dXJuIHN0cg0KDQppaWQ9MA0KZGVmIGFza0NhcHRjaGEobSxodG1sX3BhZ2UsIGNvb2tpZUphcik6DQogICAgZ2xvYmFsIGlpZA0KICAgIGlpZCs9MQ0KICAgIGV4cHJlPSBtWydleHByZXMnXQ0KICAgIHBhZ2VfdXJsID0gbVsncGFnZSddDQogICAgY2FwdGNoYV9yZWdleD1yZS5jb21waWxlKCdcJExpdmVTdHJlYW1DYXB0Y2hhXFsoW15cXV0qKVxdJykuZmluZGFsbChleHByZSlbMF0NCg0KICAgIGNhcHRjaGFfdXJsPXJlLmNvbXBpbGUoY2FwdGNoYV9yZWdleCkuZmluZGFsbChodG1sX3BhZ2UpWzBdDQojICAgIHByaW50IGV4cHJlLGNhcHRjaGFfcmVnZXgsY2FwdGNoYV91cmwNCiAgICBpZiBub3QgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlXz0naHR0cDovLycrIiIuam9pbihwYWdlX3VybC5zcGxpdCgnLycpWzI6M10pDQogICAgICAgIGlmIGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoIi8iKToNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfK2NhcHRjaGFfdXJsDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXysnLycrY2FwdGNoYV91cmwNCg0KICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApDQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KIyAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybA0KICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykNCiAgICBpZiAncmVmZXJlcicgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgaWYgJ2FnZW50JyBpbiBtOg0KICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToNCiMgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pDQoNCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgIHVybGxpYjIudXJsb3BlbihyZXEpDQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KDQogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkNCiAgICByZXNwb25zZS5jbG9zZSgpDQogICAgbG9jYWxGaWxlLmNsb3NlKCkNCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpDQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkNCiAgICByZXR1cm4gc29sdXRpb24NCg0KZGVmIGFza0NhcHRjaGFOZXcoaW1hZ2VyZWdleCxodG1sX3BhZ2UsY29va2llSmFyLG0pOg0KICAgIGdsb2JhbCBpaWQNCiAgICBpaWQrPTENCg0KDQogICAgaWYgbm90IGltYWdlcmVnZXg9PScnOg0KICAgICAgICBpZiBodG1sX3BhZ2Uuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICAgICAgcGFnZV89Z2V0VXJsKGh0bWxfcGFnZSxjb29raWVKYXI9Y29va2llSmFyKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcGFnZV89aHRtbF9wYWdlDQogICAgICAgIGNhcHRjaGFfdXJsPXJlLmNvbXBpbGUoaW1hZ2VyZWdleCkuZmluZGFsbChodG1sX3BhZ2UpWzBdDQogICAgZWxzZToNCiAgICAgICAgY2FwdGNoYV91cmw9aHRtbF9wYWdlDQogICAgICAgIGlmICdvbmVwbGF5LnR2L2VtYmVkJyBpbiBodG1sX3BhZ2U6DQogICAgICAgICAgICBpbXBvcnQgb25lcGxheQ0KICAgICAgICAgICAgcGFnZV89Z2V0VXJsKGh0bWxfcGFnZSxjb29raWVKYXI9Y29va2llSmFyKQ0KICAgICAgICAgICAgY2FwdGNoYV91cmw9b25lcGxheS5nZXRDYXB0Y2hhVXJsKHBhZ2VfKQ0KDQogICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLCBzdHIoaWlkKSsiY2FwdGNoYS5qcGciICkNCiAgICBsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpDQojICAgIHByaW50ICcgYyBjYXB1cmwnLGNhcHRjaGFfdXJsDQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQ0KICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQ0KICAgIGlmICdyZWZlcmVyJyBpbiBtOg0KICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyZXInXSkNCiAgICBpZiAnYWdlbnQnIGluIG06DQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkNCiAgICBpZiAnYWNjZXB0JyBpbiBtOg0KICAgICAgICByZXEuYWRkX2hlYWRlcignQWNjZXB0JywgbVsnYWNjZXB0J10pDQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToNCiMgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pDQoNCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgICN1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCg0KICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpDQogICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgIGxvY2FsRmlsZS5jbG9zZSgpDQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQ0KICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpDQogICAgcmV0dXJuIHNvbHV0aW9uDQoNCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KIyBGdW5jdGlvbiAgOiBHVUlFZGl0RXhwb3J0TmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAjDQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMNCiMgUGFyYW1ldGVyIDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjDQojIG5hbWUgICAgICAgIHN1Z2VzdGVkIG5hbWUgZm9yIGV4cG9ydCAgICAgICAgICAgICAgICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyANCiMgUmV0dXJucyAgIDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjDQojIG5hbWUgICAgICAgIG5hbWUgb2YgZXhwb3J0IGV4Y2x1ZGluZyBhbnkgZXh0ZW5zaW9uICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQpkZWYgVGFrZUlucHV0KG5hbWUsIGhlYWRuYW1lKToNCg0KDQogICAga2IgPSB4Ym1jLktleWJvYXJkKCdkZWZhdWx0JywgJ2hlYWRpbmcnLCBUcnVlKQ0KICAgIGtiLnNldERlZmF1bHQobmFtZSkNCiAgICBrYi5zZXRIZWFkaW5nKGhlYWRuYW1lKQ0KICAgIGtiLnNldEhpZGRlbklucHV0KEZhbHNlKQ0KICAgIHJldHVybiBrYi5nZXRUZXh0KCkNCiAgIA0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQpjbGFzcyBJbnB1dFdpbmRvdyh4Ym1jZ3VpLldpbmRvd0RpYWxvZyk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6DQogICAgICAgIHNlbGYuY3B0bG9jID0ga3dhcmdzLmdldCgnY2FwdGNoYScpDQogICAgICAgIHNlbGYuaW1nID0geGJtY2d1aS5Db250cm9sSW1hZ2UoMzM1LDMwLDYyNCw2MCxzZWxmLmNwdGxvYykNCiAgICAgICAgc2VsZi5hZGRDb250cm9sKHNlbGYuaW1nKQ0KICAgICAgICBzZWxmLmtiZCA9IHhibWMuS2V5Ym9hcmQoKQ0KDQogICAgZGVmIGdldChzZWxmKToNCiAgICAgICAgc2VsZi5zaG93KCkNCiAgICAgICAgdGltZS5zbGVlcCgyKQ0KICAgICAgICBzZWxmLmtiZC5kb01vZGFsKCkNCiAgICAgICAgaWYgKHNlbGYua2JkLmlzQ29uZmlybWVkKCkpOg0KICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQ0KICAgICAgICAgICAgc2VsZi5jbG9zZSgpDQogICAgICAgICAgICByZXR1cm4gdGV4dA0KICAgICAgICBzZWxmLmNsb3NlKCkNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCmRlZiBnZXRFcG9jVGltZSgpOg0KICAgIGltcG9ydCB0aW1lDQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkqMTAwMCkpDQoNCmRlZiBnZXRFcG9jVGltZTIoKToNCiAgICBpbXBvcnQgdGltZQ0KICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKSkNCg0KZGVmIGdldF9wYXJhbXMoKToNCiAgICAgICAgcGFyYW09W10NCiAgICAgICAgcGFyYW1zdHJpbmc9c3lzLmFyZ3ZbMl0NCiAgICAgICAgaWYgbGVuKHBhcmFtc3RyaW5nKT49MjoNCiAgICAgICAgICAgIHBhcmFtcz1zeXMuYXJndlsyXQ0KICAgICAgICAgICAgY2xlYW5lZHBhcmFtcz1wYXJhbXMucmVwbGFjZSgnPycsJycpDQogICAgICAgICAgICBpZiAocGFyYW1zW2xlbihwYXJhbXMpLTFdPT0nLycpOg0KICAgICAgICAgICAgICAgIHBhcmFtcz1wYXJhbXNbMDpsZW4ocGFyYW1zKS0yXQ0KICAgICAgICAgICAgcGFpcnNvZnBhcmFtcz1jbGVhbmVkcGFyYW1zLnNwbGl0KCcmJykNCiAgICAgICAgICAgIHBhcmFtPXt9DQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ocGFpcnNvZnBhcmFtcykpOg0KICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXt9DQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9cGFpcnNvZnBhcmFtc1tpXS5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgaWYgKGxlbihzcGxpdHBhcmFtcykpPT0yOg0KICAgICAgICAgICAgICAgICAgICBwYXJhbVtzcGxpdHBhcmFtc1swXV09c3BsaXRwYXJhbXNbMV0NCiAgICAgICAgcmV0dXJuIHBhcmFtDQoNCmRlZiBnZXRGYXZvcml0ZXMoKToNCiAgICAgICAgaXRlbXMgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpDQogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQ0KICAgICAgICBmb3IgaSBpbiBpdGVtczoNCiAgICAgICAgICAgIG5hbWUgPSBpWzBdDQogICAgICAgICAgICB1cmwgPSBpWzFdDQogICAgICAgICAgICBpY29uaW1hZ2UgPSBpWzJdDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZmFuQXJ0ID0gaVszXQ0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaWNvbmltYWdlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgICAgICB0cnk6IHBsYXlsaXN0ID0gaVs1XQ0KICAgICAgICAgICAgZXhjZXB0OiBwbGF5bGlzdCA9IE5vbmUNCiAgICAgICAgICAgIHRyeTogcmVnZXhzID0gaVs2XQ0KICAgICAgICAgICAgZXhjZXB0OiByZWdleHMgPSBOb25lDQoNCiAgICAgICAgICAgIGlmIGlbNF0gPT0gMDoNCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5BcnQsJycsJycsJycsJ2ZhdicscGxheWxpc3QscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsaVs0XSxpY29uaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLCdmYXYnKQ0KDQpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOg0KICAgICAgICBmYXZMaXN0ID0gW10NCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBzZWVtcyB0aGF0IGFmdGVyDQogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09RmFsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpDQogICAgICAgICAgICBmYXZMaXN0LmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0LHJlZ2V4cykpDQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkNCiAgICAgICAgICAgIGEuY2xvc2UoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykNCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpDQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhKQ0KICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpDQogICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkNCiAgICAgICAgICAgIGIuY2xvc2UoKQ0KDQpkZWYgcm1GYXZvcml0ZShuYW1lKToNCiAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkNCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6DQogICAgICAgICAgICBpZiBkYXRhW2luZGV4XVswXT09bmFtZToNCiAgICAgICAgICAgICAgICBkZWwgZGF0YVtpbmRleF0NCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpDQogICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpDQoNCmRlZiB1cmxzb2x2ZXIodXJsKToNCiAgICBpbXBvcnQgcmVzb2x2ZXVybA0KICAgIGhvc3QgPSByZXNvbHZldXJsLkhvc3RlZE1lZGlhRmlsZSh1cmwpDQogICAgaWYgaG9zdDoNCiAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZldXJsLnJlc29sdmUodXJsKQ0KICAgICAgICByZXNvbHZlZCA9IHJlc29sdmVyDQogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzb2x2ZWQsbGlzdCk6DQogICAgICAgICAgICBmb3IgayBpbiByZXNvbHZlZDoNCiAgICAgICAgICAgICAgICBxdWFsaXR5ID0gYWRkb24uZ2V0U2V0dGluZygncXVhbGl0eScpDQogICAgICAgICAgICAgICAgaWYga1sncXVhbGl0eSddID09ICdIRCcgIDoNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICdTRCcgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJzEwODBwJyBhbmQgYWRkb24uZ2V0U2V0dGluZygnMTA4MHBxdWFsaXR5JykgPT0gJ3RydWUnIDoNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZlZA0KICAgIGVsc2U6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EscmVzb2x2ZXVybCBkb25vdCBzdXBwb3J0IHRoaXMgZG9tYWluLiAtICw1MDAwKSIpDQogICAgICAgIHJlc29sdmVyPXVybA0KICAgIHJldHVybiByZXNvbHZlcg0KDQpkZWYgdHJ5cGxheSh1cmwsbGlzdGl0ZW0scGRpYWxvZ3VlPU5vbmUpOiAgICANCg0KICAgIGlmIHVybC5sb3dlcigpLnN0YXJ0c3dpdGgoJ3BsdWdpbicpIGFuZCAneW91dHViZScgbm90IGluICB1cmwubG93ZXIoKToNCiAgICAgICAgcHJpbnQgJ3BsYXlpbmcgdmlhIHJ1bnBsdWdpbicNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKSANCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoOCk6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDUwMCkgIyNzbGVlcCBmb3IgMTAgc2Vjb25kcywgaGFsZiBlYWNoIHRpbWUNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2NvbmRpJw0KICAgICAgICAgICAgICAgIGlmIHhibWMuZ2V0Q29uZFZpc2liaWxpdHkoIlBsYXllci5IYXNNZWRpYSIpIGFuZCB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIHByaW50ICdyZXR1cm5pbmcgbm93Jw0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICBpbXBvcnQgIEN1c3RvbVBsYXllcix0aW1lDQoNCiAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICBwbGF5ZXIucGRpYWxvZ3VlPXBkaWFsb2d1ZQ0KICAgIHN0YXJ0ID0gdGltZS50aW1lKCkgDQogICAgI3hibWMuUGxheWVyKCkucGxheSggbGl2ZUxpbmssbGlzdGl0ZW0pDQogICAgcHJpbnQgJ2dvaW5nIHRvIHBsYXknDQogICAgaW1wb3J0IHRpbWUNCiAgICBiZWZvcmVzdGFydD10aW1lLnRpbWUoKQ0KICAgIHBsYXllci5wbGF5KCB1cmwsIGxpc3RpdGVtKQ0KICAgIHhibWMuc2xlZXAoMTAwMCkNCiAgICANCiAgICB0cnk6DQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDQwMCkNCiAgICAgICAgICAgDQogICAgICAgICAgICBpZiBwbGF5ZXIudXJscGxheWVkOg0KICAgICAgICAgICAgICAgIHByaW50ICd5ZXMgcGxheWVkJw0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBpZiB0aW1lLnRpbWUoKS1iZWZvcmVzdGFydD40OiByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICN4Ym1jLnNsZWVwKDEwMDApDQogICAgZXhjZXB0OiBwYXNzDQogICAgcHJpbnQgJ25vdCBwbGF5ZWQnLHVybA0KICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgcGxheV9wbGF5bGlzdChuYW1lLCBtdV9wbGF5bGlzdCxxdWV1ZVZpZGVvPU5vbmUpOg0KICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoeGJtYy5QTEFZTElTVF9WSURFTykNCiAgICAgICAgI3ByaW50ICdtdV9wbGF5bGlzdCcsbXVfcGxheWxpc3QNCiAgICAgICAgaWYgJyQkTFNQbGF5T25seU9uZSQkJyBpbiBtdV9wbGF5bGlzdFswXToNCiAgICAgICAgICAgIG11X3BsYXlsaXN0WzBdPW11X3BsYXlsaXN0WzBdLnJlcGxhY2UoJyQkTFNQbGF5T25seU9uZSQkJywnJykNCiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQ0KICAgICAgICAgICAgbmFtZXMgPSBbXQ0KICAgICAgICAgICAgaWxvb3A9MA0KICAgICAgICAgICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkNCiAgICAgICAgICAgIHByb2dyZXNzLmNyZWF0ZSgnUHJvZ3Jlc3MnLCAnVHJ5aW5nIE11bHRpcGxlIExpbmtzJykNCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0Og0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgaWYgJyQkbHNuYW1lPScgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPWkuc3BsaXQoJyQkbHNuYW1lPScpWzFdLnNwbGl0KCcmcmVnZXhzJylbMF0NCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXVfcGxheWxpc3RbaWxvb3BdPWkuc3BsaXQoJyQkbHNuYW1lPScpWzBdKygnJnJlZ2V4cycraS5zcGxpdCgnJnJlZ2V4cycpWzFdIGlmICcmcmVnZXhzJyBpbiBpIGVsc2UgJycpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jDQogICAgICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkNCiAgICAgICAgICAgICAgICBpbmRleD1pbG9vcA0KICAgICAgICAgICAgICAgIGlsb29wKz0xDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcGxheW5hbWU9bmFtZXNbaW5kZXhdDQogICAgICAgICAgICAgICAgaWYgcHJvZ3Jlc3MuaXNjYW5jZWxlZCgpOiByZXR1cm4gDQogICAgICAgICAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKCBpbG9vcC9sZW4obXVfcGxheWxpc3QpKjEwMCwiIiwgIkxpbmsjJWQiJShpbG9vcCkscGxheW5hbWUgICkNCiAgICAgICAgICAgICAgICBwcmludCAnYXV0byBwbGF5bmFtZXh4JyxwbGF5bmFtZQ0KICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSxuYW1lLGljb25pbWFnZSxUcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKHBsYXluYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpwbGF5bmFtZX0pDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICAgICAgICAgICAgICB1cmx0b3BsYXk9dXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsdG9wbGF5KQ0KICAgICAgICAgICAgICAgICAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHRvcGxheSxsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybHRvcGxheSxsaXopDQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6DQojICAgICAgICAgICAgICAgICAgICBwcmludCBtdV9wbGF5bGlzdFtpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpDQojICAgICAgICAgICAgICAgICAgICBwcmludCBzZXBhdGUNCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIHVybDIgPSB1cmwucmVwbGFjZSgnOycsJycpDQogICAgICAgICAgICAgICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0ocGxheW5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOnBsYXluYW1lfSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybDIpDQogICAgICAgICAgICAgICAgICAgICN4Ym1jLlBsYXllcigpLnBsYXkodXJsMixsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybDIsbGl6KQ0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHVybD11cmwuc3BsaXQoJyZyZWdleHM9JylbMF0NCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICAgICAgICAgICAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCxsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybCxsaXopDQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwbGF5ZWQnLHBsYXllZA0KICAgICAgICAgICAgICAgIHByaW50ICdwbGF5ZWQnLHBsYXllZA0KICAgICAgICAgICAgICAgIGlmIHBsYXllZDogcmV0dXJuDQogICAgICAgICAgICByZXR1cm4gICAgIA0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZScgYW5kIG5vdCBxdWV1ZVZpZGVvIDoNCiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQ0KICAgICAgICAgICAgbmFtZXMgPSBbXQ0KICAgICAgICAgICAgaWxvb3A9MA0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgaWYgJyQkbHNuYW1lPScgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPWkuc3BsaXQoJyQkbHNuYW1lPScpWzFdLnNwbGl0KCcmcmVnZXhzJylbMF0NCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXVfcGxheWxpc3RbaWxvb3BdPWkuc3BsaXQoJyQkbHNuYW1lPScpWzBdKygnJnJlZ2V4cycraS5zcGxpdCgnJnJlZ2V4cycpWzFdIGlmICcmcmVnZXhzJyBpbiBpIGVsc2UgJycpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jDQogICAgICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWxvb3ArPTENCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpDQogICAgICAgICAgICBpZiBpbmRleCA+PSAwOg0KICAgICAgICAgICAgICAgIHBsYXluYW1lPW5hbWVzW2luZGV4XQ0KICAgICAgICAgICAgICAgIHByaW50ICdwbGF5bmFtZXh4JyxwbGF5bmFtZQ0KICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSxuYW1lLGljb25pbWFnZSxUcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKHBsYXluYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpwbGF5bmFtZX0pDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICAgICAgICAgICAgICB1cmx0b3BsYXk9dXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsdG9wbGF5KQ0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsdG9wbGF5LGxpeikNCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoNCiMgICAgICAgICAgICAgICAgICAgIHByaW50IG11X3BsYXlsaXN0W2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykNCiMgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQ0KICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkNCiAgICAgICAgICAgICAgICAgICAgdXJsMiA9IHVybC5yZXBsYWNlKCc7JywnJykNCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsMikNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybDIsbGl6KQ0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHVybD11cmwuc3BsaXQoJyZyZWdleHM9JylbMF0NCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsLGxpeikNCiAgICAgICAgZWxpZiBub3QgcXVldWVWaWRlbzoNCiAgICAgICAgICAgICNwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoMSkgIyAxIG1lYW5zIHZpZGVvDQogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpDQogICAgICAgICAgICBpdGVtID0gMA0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgaXRlbSArPSAxDQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpDQogICAgICAgICAgICAgICAgIyBEb24ndCBkbyB0aGlzIGFzIHJlZ2V4IHBhcnNlZCBtaWdodCB0YWtlIGxvbmdlcg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgIiRkb3JlZ2V4IiBpbiBpOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gaS5zcGxpdCgnJnJlZ2V4cz0nKQ0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIGVsaWYgIiZtb2RlPTE5IiBpbiBpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsc29sdmVyKGkucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIHVybDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZCh1cmwsIGluZm8pDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQ0KICAgICAgICAgICAgICAgICAgICBwYXNzICN4Ym1jLlBsYXllcigpLnBsYXkodXJsKQ0KDQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykNCiAgICAgICAgZWxzZToNCg0KICAgICAgICAgICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbShuYW1lKQ0KICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChtdV9wbGF5bGlzdCwgbGlzdGl0ZW0pDQoNCmRlZiBkb3dubG9hZF9maWxlKG5hbWUsIHVybCk6DQogICAgICAgIA0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJykgPT0gIiI6DQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbignQW5kcm9pZHJlcHVibGljYScsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgYWRkb24ub3BlblNldHRpbmdzKCkNCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQ0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykNCiAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0FuZHJvaWRyZXB1YmxpY2EnLCAnRG8geW91IHdhbnQgdG8gYWRkIHRoaXMgZmlsZSBhcyBhIHNvdXJjZT8nKQ0KICAgICAgICBpZiByZXQ6DQogICAgICAgICAgICBhZGRTb3VyY2Uob3MucGF0aC5qb2luKGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSwgbmFtZSkpDQoNCmRlZiBfc2VhcmNoKHVybCxuYW1lKToNCiAgICMgcHJpbnQgdXJsLG5hbWUNCiAgICBwbHVnaW5zZWFyY2h1cmxzID0gWydwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXNob3dzX3NlYXJjaCcsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnNhbHRzLz9tb2RlPXNlYXJjaCZhbXA7c2VjdGlvbj1Nb3ZpZXMnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnNhbHRzLz9tb2RlPXNlYXJjaCZhbXA7c2VjdGlvbj1UVicsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ubXVjaG1vdmllcy5oZC8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpb296LmNvLz9hY3Rpb249cm9vdF9zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLm9yb3JvdHYvP2FjdGlvbj1zaG93c19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlpZnltb3ZpZXMuaGQvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5jYXJ0b29uaGR0d28vP2Rlc2NyaXB0aW9uJmFtcDtmYW5hcnQmYW1wO2ljb25pbWFnZSZhbXA7bW9kZT0zJmFtcDtuYW1lPVNlYXJjaCZhbXA7dXJsPXVybCcsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9rb2Rpb24vc2VhcmNoL2xpc3QvJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9c2VhcmNoJmFtcDt1cmwnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpbWVvL2tvZGlvbi9zZWFyY2gvbGlzdC8nXA0KICAgICAgICAgICAgIF0NCiAgICBuYW1lcyA9IFsnR2Vuc2lzIFRWJywnR2VuZXNpcyBNb3ZpZScsJ1NhbHQgbW92aWUnLCdzYWx0IFRWJywnTXVjaG1vdmllcycsJ3Zpb296JywnT1Jvcm9UVicsXA0KICAgICAgICAgICAgICdZaWZ5bW92aWVzJywnY2FydG9vbkhEJywnWW91dHViZScsJ0RhaWx5TW90aW9uJywnVmltZW8nXQ0KICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQ0KDQogICAgaWYgaW5kZXggPj0gMDoNCiAgICAgICAgdXJsID0gcGx1Z2luc2VhcmNodXJsc1tpbmRleF0NCiMgICAgICAgIHByaW50ICd1cmwnLHVybA0KICAgICAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpDQoNCmRlZiBhZGREaXIobmFtZSx1cmwsbW9kZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsY3JlZGl0cyxzaG93Y29udGV4dD1GYWxzZSxyZWdleHM9Tm9uZSxyZWdfdXJsPU5vbmUsYWxsaW5mbz17fSk6DQoNCiAgICAgICAgI3ByaW50ICdhZGREaXInDQoNCiAgICAgICAgaWYgcmVnZXhzIGFuZCBsZW4ocmVnZXhzKT4wOg0KICAgICAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSsiJnJlZ2V4cz0iK3JlZ2V4cw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KQ0KICAgICAgICANCiAgICAgICAgb2s9VHJ1ZQ0KICAgICAgICBpZiBkYXRlID09ICcnOg0KICAgICAgICAgICAgZGF0ZSA9IE5vbmUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlDQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdEZvbGRlci5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgIGlmIGxlbihhbGxpbmZvKSA8MSA6DQogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUsICJjcmVkaXRzIjogY3JlZGl0cyB9KQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPSBhbGxpbmZvKQ0KICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkNCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6DQogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdDQogICAgICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQ0KICAgICAgICAgICAgcGFyZW50YWxibG9jaz0gcGFyZW50YWxibG9jaz09InRydWUiDQogICAgICAgICAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpDQojICAgICAgICAgICAgcHJpbnQgJ3BhcmVudGFsYmxvY2tlZHBpbicscGFyZW50YWxibG9ja2VkcGluDQogICAgICAgICAgICBpZiBsZW4ocGFyZW50YWxibG9ja2VkcGluKT4wOg0KICAgICAgICAgICAgICAgIGlmIHBhcmVudGFsYmxvY2s6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rpc2FibGUgUGFyZW50YWwgQmxvY2snLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU1Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0VuYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTYmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ3NvdXJjZSc6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBuYW1lIGluIHN0cihTT1VSQ0VTKToNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gU291cmNlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9OCZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZG93bmxvYWQnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rvd25sb2FkJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9OSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdmYXYnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIEFuZHJvaWRyZXB1YmxpY2EgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICchIXVwZGF0ZSc6DQogICAgICAgICAgICAgICAgZmF2X3BhcmFtczIgPSAoDQogICAgICAgICAgICAgICAgICAgICclcz91cmw9JXMmbW9kZT0xNyZyZWdleHM9JXMnDQogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHJlZ191cmwpLCByZWdleHMpDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1IgeWVsbG93XSEhdXBkYXRlWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zMikpDQogICAgICAgICAgICBpZiBub3QgbmFtZSBpbiBGQVY6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFuZHJvaWRyZXB1YmxpY2EgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpLCBtb2RlKSkpDQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkNCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeixpc0ZvbGRlcj1UcnVlKQ0KICAgICAgICByZXR1cm4gb2sNCg0KZGVmIHl0ZGxfZG93bmxvYWQodXJsLHRpdGxlLG1lZGlhX3R5cGU9J3ZpZGVvJyk6DQogICAgIyBwbGF5IGluIHhibWMgd2hpbGUgcGxheWluZyBnbyBiYWNrIHRvIGNvbnRleHRNZW51KGMpIHRvICIhIURvd25sb2FkISEiDQogICAgIyBUcmlhbCB5YXNjZWVuOiBzZXBlcmF0ZSB8VXNlci1BZ2VudD0NCiAgICBpbXBvcnQgeW91dHViZWRsDQogICAgDQogICAgaWYgbm90IHVybCA9PSAnJzoNCiAgICAgICAgaWYgbWVkaWFfdHlwZT09ICdhdWRpbyc6DQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlLGF1ZGlvPVRydWUpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlKQ0KICAgIGVsaWYgeGJtYy5QbGF5ZXIoKS5pc1BsYXlpbmcoKSA9PSBUcnVlIDoNCiAgICAgICAgaW1wb3J0IFlEU3RyZWFtRXh0cmFjdG9yDQogICAgICAgIGlmIFlEU3RyZWFtRXh0cmFjdG9yLmlzRG93bmxvYWRpbmcoKSA9PSBUcnVlOg0KDQogICAgICAgICAgICBZRFN0cmVhbUV4dHJhY3Rvci5tYW5hZ2VEb3dubG9hZHMoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jLlBsYXllcigpLmdldFBsYXlpbmdGaWxlKCkNCg0KICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jX3VybC5zcGxpdCgnfFVzZXItQWdlbnQ9JylbMF0NCiAgICAgICAgICAgIGluZm8gPSB7J3VybCc6eGJtY191cmwsJ3RpdGxlJzp0aXRsZSwnbWVkaWFfdHlwZSc6bWVkaWFfdHlwZX0NCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQoJycsZG93bmxvYWQ9VHJ1ZSxkbF9pbmZvPWluZm8pDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikNCg0KIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQ0KZGVmIGFzY2lpKHN0cmluZyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpDQogICAgcmV0dXJuIHN0cmluZw0KDQpkZWYgdW5pKHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKToNCiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6DQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgICBzdHJpbmcgPSB1bmljb2RlKHN0cmluZywgZW5jb2RpbmcsICdpZ25vcmUnKQ0KICAgIHJldHVybiBzdHJpbmcNCg0KZGVmIHJlbW92ZU5vbkFzY2lpKHMpOiByZXR1cm4gIiIuam9pbihmaWx0ZXIobGFtYmRhIHg6IG9yZCh4KTwxMjgsIHMpKQ0KDQpkZWYgc2VuZEpTT04oIGNvbW1hbmQpOg0KICAgIGRhdGEgPSAnJw0KICAgIHRyeToNCiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEModW5pKGNvbW1hbmQpKQ0KICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6DQogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKGFzY2lpKGNvbW1hbmQpKQ0KDQogICAgcmV0dXJuIHVuaShkYXRhKQ0KDQpkZWYgcGx1Z2lucXVlcnlieUpTT04odXJsLGdpdmVfbWVfcmVzdWx0PU5vbmUscGxheWxpc3Q9RmFsc2UpOg0KICAgIGlmICdhdWRpbycgaW4gdXJsOg0KICAgICAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOiB7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsICJwcm9wZXJ0aWVzIjogWyJ0aXRsZSIsICJhbGJ1bSIsICJhcnRpc3QiLCAiZHVyYXRpb24iLCJ0aHVtYm5haWwiLCAieWVhciJdfSwgImlkIjogMX0nKSAldXJsDQogICAgZWxzZToNCiAgICAgICAganNvbl9xdWVyeSA9IHVuaSgneyJqc29ucnBjIjoiMi4wIiwibWV0aG9kIjoiRmlsZXMuR2V0RGlyZWN0b3J5IiwicGFyYW1zIjp7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsInByb3BlcnRpZXMiOlsgInBsb3QiLCJwbGF5Y291bnQiLCJkaXJlY3RvciIsICJnZW5yZSIsInZvdGVzIiwiZHVyYXRpb24iLCJ0cmFpbGVyIiwicHJlbWllcmVkIiwidGh1bWJuYWlsIiwidGl0bGUiLCJ5ZWFyIiwiZGF0ZWFkZGVkIiwiZmFuYXJ0IiwicmF0aW5nIiwic2Vhc29uIiwiZXBpc29kZSIsInN0dWRpbyIsIm1wYWEiXX0sImlkIjoxfScpICV1cmwNCiAgICBqc29uX2ZvbGRlcl9kZXRhaWwgPSBqc29uLmxvYWRzKHNlbmRKU09OKGpzb25fcXVlcnkpKQ0KICAgICNwcmludCBqc29uX2ZvbGRlcl9kZXRhaWwNCiAgICBpZiBnaXZlX21lX3Jlc3VsdDoNCiAgICAgICAgcmV0dXJuIGpzb25fZm9sZGVyX2RldGFpbA0KICAgIGlmIGpzb25fZm9sZGVyX2RldGFpbC5oYXNfa2V5KCdlcnJvcicpOg0KICAgICAgICByZXR1cm4NCiAgICBlbHNlOg0KDQogICAgICAgIGZvciBpIGluIGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10gOg0KICAgICAgICAgICAgbWV0YSA9e30NCiAgICAgICAgICAgIHVybCA9IGlbJ2ZpbGUnXQ0KICAgICAgICAgICAgbmFtZSA9IHJlbW92ZU5vbkFzY2lpKGlbJ2xhYmVsJ10pDQogICAgICAgICAgICB0aHVtYm5haWwgPSByZW1vdmVOb25Bc2NpaShpWyd0aHVtYm5haWwnXSkNCiAgICAgICAgICAgIGZhbmFydCA9IHJlbW92ZU5vbkFzY2lpKGlbJ2ZhbmFydCddKQ0KICAgICAgICAgICAgbWV0YSA9IGRpY3QoKGssdikgZm9yIGssIHYgaW4gaS5pdGVyaXRlbXMoKSBpZiBub3QgdiA9PSAnMCcgb3Igbm90IHYgPT0gLTEgb3IgdiA9PSAnJykNCiAgICAgICAgICAgIG1ldGEucG9wKCJmaWxlIiwgTm9uZSkNCiAgICAgICAgICAgIGlmIGlbJ2ZpbGV0eXBlJ10gPT0gJ2ZpbGUnOg0KICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0Og0KICAgICAgICAgICAgICAgICAgICBwbGF5X3BsYXlsaXN0KG5hbWUsdXJsLHF1ZXVlVmlkZW89JzEnKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJyxOb25lLCcnLHRvdGFsPWxlbihqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddKSxhbGxpbmZvPW1ldGEpDQogICAgICAgICAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpDQogICAgICAgICAgICAgICAgICAgIGlmIGlbJ3R5cGUnXSBhbmQgaVsndHlwZSddID09ICd0dnNob3cnIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAndHZzaG93cycpDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaVsnZXBpc29kZSddID4gMCA6DQogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ2VwaXNvZGVzJykNCg0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsNTMsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJyxhbGxpbmZvPW1ldGEpDQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZGVmIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLHNob3djb250ZXh0LHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCxzZXRDb29raWU9IiIsYWxsaW5mbz17fSk6DQogICAgICAgICNwcmludCAndXJsLG5hbWUscmVnZXgnLHVybCxuYW1lLGljb25pbWFnZSxyZWdleHMNCiAgICAgICAgY29udGV4dE1lbnUgPVtdDQogICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpDQogICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIg0KICAgICAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpDQojICAgICAgICBwcmludCAncGFyZW50YWxibG9ja2VkcGluJyxwYXJlbnRhbGJsb2NrZWRwaW4NCiAgICAgICAgaWYgbGVuKHBhcmVudGFsYmxvY2tlZHBpbik+MDoNCiAgICAgICAgICAgIGlmIHBhcmVudGFsYmxvY2s6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRGlzYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTUmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0VuYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTYmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JykNCiAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIG9rID0gVHJ1ZQ0KICAgICAgICBpc0ZvbGRlcj1GYWxzZQ0KICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICBtb2RlID0gJzE3Jw0KICAgICAgICAgICAgaWYgJ2xpc3RyZXBlYXQnIGluIHJlZ2V4czoNCiAgICAgICAgICAgICAgICBpc0ZvbGRlcj1UcnVlDQojICAgICAgICAgICAgICAgcHJpbnQgJ3NldHRpbmcgYXMgZm9sZGVyIGluIGxpbmsnDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgIGVsaWYgIChhbnkoeCBpbiB1cmwgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKSkgb3IgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOScpOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOScsJycpDQogICAgICAgICAgICBtb2RlID0gJzE5Jw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBlbGlmIHVybC5lbmRzd2l0aCgnJm1vZGU9MTgnKToNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQ0KICAgICAgICAgICAgbW9kZSA9ICcxOCcNCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIzJm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2RsYXVkaW9vbmx5JykgPT0gJ3RydWUnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJyEhRG93bmxvYWQgW0NPTE9SIHNlYWJsdWVdQXVkaW8hIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjQmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgZWxpZiB1cmwuZW5kc3dpdGgoJyZtb2RlPTIwJyk6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTIwJywnJykNCiAgICAgICAgICAgIG1vZGUgPSAnMjAnDQogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0yMicpOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0yMicsJycpDQogICAgICAgICAgICBtb2RlID0gJzIyJyAgICAgIA0KICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpOg0KICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoNCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykNCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwNCiAgICAgICAgICAgIG1vZGUgPSAnMTInDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBtb2RlID0gJzEyJw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBpZiAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyBpbiB1cmw6DQogICAgICAgICAgICAgIHl0X2F1ZGlvX3VybCA9IHVybC5yZXBsYWNlKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nLCdodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PScpDQogICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJyEhRG93bmxvYWQgW0NPTE9SIGJsdWVdQXVkaW8hIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjQmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHl0X2F1ZGlvX3VybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iDQogICAgICAgIHBsYXlfbGlzdCA9IEZhbHNlDQogICAgICAgIA0KICAgICAgICBpZiBwbGF5bGlzdDoNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSIgYW5kICckJExTUGxheU9ubHlPbmUkJCcgbm90IGluIHBsYXlsaXN0WzBdIDoNCiAgICAgICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdSArPSAibW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzIiAlKHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkNCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSArICdbQ09MT1IgbWFnZW50YV0gKCcgKyBzdHIobGVuKHBsYXlsaXN0KSkgKyAnIGl0ZW1zIClbL0NPTE9SXScNCiAgICAgICAgICAgICAgICBwbGF5X2xpc3QgPSBUcnVlDQogICAgICAgIGVsaWYgbW9kZT09JzIyJyBvciAobW9kZT09JzE3JyBhbmQgdXJsLmVuZHN3aXRoKCcmbW9kZT0yMicpKTogICAgICAgICAgICAgDQogICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbmFtZT0iK3VybGxpYi5xdW90ZShuYW1lKSsiJm1vZGU9Iittb2RlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUNCiAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cw0KICAgICAgICBpZiBub3Qgc2V0Q29va2llID09ICcnOg0KICAgICAgICAgICAgdSArPSAiJnNldENvb2tpZT0iK3VybGxpYi5xdW90ZV9wbHVzKHNldENvb2tpZSkNCiAgICAgICAgaWYgaWNvbmltYWdlIGFuZCAgbm90IGljb25pbWFnZSA9PSAnJzoNCiAgICAgICAgICAgIHUgKz0gIiZpY29uaW1hZ2U9Iit1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpDQogICAgICAgICAgICANCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoNCiAgICAgICAgICAgIGRhdGUgPSBOb25lDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQ0KICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQoNCiAgICAgICAgI2lmIGlzRm9sZGVyOg0KICAgICAgICBpZiBhbGxpbmZvPT1Ob25lIG9yIGxlbihhbGxpbmZvKSA8MToNCiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPWFsbGluZm8pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQ0KIA0KICAgICAgICBpZiAobm90IHBsYXlfbGlzdCkgYW5kIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCkgYW5kIG5vdCAnJFBMQVlFUlBST1hZJD0nIGluIHVybCBhbmQgbm90IChtb2RlPT0nMjInIG9yIChtb2RlPT0nMTcnIGFuZCB1cmwuZW5kc3dpdGgoJyZtb2RlPTIyJykpKTojICAobm90IHVybC5zdGFydHN3aXRoKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyJykpOg0KICAgICAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgICAgICNwcmludCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykNCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ25vdHBsYXlhYmxlJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIGFuZCAnbGlzdHJlcGVhdCcgbm90IGluICB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgOg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NldHRpbmcgaXNwbGF5YWJsZScsdXJsLCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyksdXJsDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdOT1Qgc2V0dGluZyBpc3BsYXlhYmxlJyt1cmwpDQogICAgICAgIA0KICAgICAgICBpZiBzaG93Y29udGV4dDoNCiAgICAgICAgICAgICNjb250ZXh0TWVudSA9IFtdDQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoDQogICAgICAgICAgICAgICAgICAgICgnUmVtb3ZlIGZyb20gQW5kcm9pZHJlcHVibGljYSBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpDQogICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICBlbGlmIG5vdCBuYW1lIGluIEZBVjoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoDQogICAgICAgICAgICAgICAgICAgICAgICAnJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9MCcNCiAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgNCiAgICAgICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJw0KICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZS5lbmNvZGUoInV0Zi04IikpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQuZW5jb2RlKCJ1dGYtOCIpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBpZiBwbGF5bGlzdDoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAncGxheWxpc3Q9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKQ0KICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAiJnJlZ2V4cz0iK3JlZ2V4cw0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBBbmRyb2lkcmVwdWJsaWNhIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMpKQ0KICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOg0KICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6DQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0X25hbWUgPSBuYW1lLnNwbGl0KCcpICcpWzFdDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMocGxheWxpc3RfbmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykNCiAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICNwcmludCAnYWRkaW5nJyxuYW1lDQogICAgDQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCxpc0ZvbGRlcj1pc0ZvbGRlcikNCg0KICAgICAgICAjcHJpbnQgJ2FkZGVkJyxuYW1lDQogICAgICAgIHJldHVybiBvaw0KDQpkZWYgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZD1UcnVlLHJlZz1Ob25lKToNCiAgICAjcHJpbnQgJ3BsYXlzZXRyZXNvbHZlZCcsdXJsLG5hbWUsc2V0cmVzb2x2ZWQNCiAgICBwcmludCAncGxheXNldHJlc29sdmVkJw0KICAgIGlmIHVybD09Tm9uZTogDQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCiAgICAgICAgcmV0dXJuDQoNCiAgICBpZiAnJm1vZGU9MjInIGluIHVybDoNCiAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UNCiAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0yMicsJycpDQogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iDQogICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZuYW1lPSIrdXJsbGliLnF1b3RlKG5hbWUpKyImbW9kZT0yMiINCiAgICAgICAgdXJsID0gdQ0KDQogICAgaWYgc2V0cmVzb2x2ZWQ6DQogICAgICAgIHNldHJlcz1UcnVlDQogICAgICAgIGlmICckJExTRGlyZWN0JCQnIGluIHVybDoNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJCRMU0RpcmVjdCQkJywnJykNCiAgICAgICAgICAgIHNldHJlcz1GYWxzZQ0KICAgICAgICBpZiByZWcgYW5kICdub3RwbGF5YWJsZScgaW4gcmVnOg0KICAgICAgICAgICAgc2V0cmVzPUZhbHNlDQoNCiAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpuYW1lfSkNCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgIGlmICcmbW9kZT0xOScgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybHNvbHZlcih1cmwucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpDQogICAgICAgIGVsaWYgJyZtb2RlPTIwJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTIwJywnJykNCiAgICAgICAgICAgIGlmICd8JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgdXJsLHN0cmhkciA9IHVybC5zcGxpdCgnfCcpDQogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdpbnB1dHN0cmVhbS5hZGFwdGl2ZS5zdHJlYW1faGVhZGVycycsIHN0cmhkcikNCgkJCQkNCiAgICAgICAgICAgIGlmICcubTN1OCcgaW4gdXJsOg0KICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnaW5wdXRzdHJlYW1hZGRvbicsICdpbnB1dHN0cmVhbS5hZGFwdGl2ZScpDQogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdpbnB1dHN0cmVhbS5hZGFwdGl2ZS5tYW5pZmVzdF90eXBlJywgJ2hscycpDQogICAgICAgICAgICAgICAgbGl6LnNldE1pbWVUeXBlKCdhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3N0cmVhbV91cmwnKQ0KICAgICAgICAgICAgICAgIGxpei5zZXRDb250ZW50TG9va3VwKEZhbHNlKQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsaWYgJy5tcGQnIGluIHVybDoNCiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ2lucHV0c3RyZWFtYWRkb24nLCAnaW5wdXRzdHJlYW0uYWRhcHRpdmUnKQ0KICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnaW5wdXRzdHJlYW0uYWRhcHRpdmUubWFuaWZlc3RfdHlwZScsICdtcGQnKQ0KICAgICAgICAgICAgICAgIGxpei5zZXRNaW1lVHlwZSgnYXBwbGljYXRpb24vZGFzaCt4bWwnKQ0KICAgICAgICAgICAgICAgIGxpei5zZXRDb250ZW50TG9va3VwKEZhbHNlKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbGlmICcuaXNtJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdpbnB1dHN0cmVhbWFkZG9uJywgJ2lucHV0c3RyZWFtLmFkYXB0aXZlJykNCiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ2lucHV0c3RyZWFtLmFkYXB0aXZlLm1hbmlmZXN0X3R5cGUnLCAnaXNtJykNCiAgICAgICAgICAgICAgICBsaXouc2V0TWltZVR5cGUoJ2FwcGxpY2F0aW9uL3ZuZC5tcy1zc3RyK3htbCcpDQogICAgICAgICAgICAgICAgbGl6LnNldENvbnRlbnRMb29rdXAoRmFsc2UpDQogICAgICAgIA0KICAgICAgICAjIGVsaWYgJyZtb2RlPTIyJyBpbiB1cmw6DQogICAgICAgICMgICAgIHByaW50ICJzbHByb3h5Ig0KICAgICAgICAjICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTIyJywnJykNCiAgICAgICAgIyAgICAgdHJ5Og0KICAgICAgICAjICAgICAgICAgZnJvbSBkc3AgaW1wb3J0IHN0cmVhbWxpbmtfcHJveHkNCiAgICAgICAgIyAgICAgICAgIHNsUHJveHkgPSBzdHJlYW1saW5rX3Byb3h5LlNMUHJveHlfSGVscGVyKCkNCiAgICAgICAgIyAgICAgICAgIHRyeToNCiAgICAgICAgIyAgICAgICAgICAgICBxID0gIHJlLmZpbmRhbGwocidcJFwkUVVBTElUWT0oW15cJFwkXSspXCRcJCcsIHVybClbMF0NCiAgICAgICAgIyAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgIyAgICAgICAgICAgICBxID0gJ2Jlc3QnDQogICAgICAgICMgICAgICAgICB1cmwgPSByZS5zdWIocidcJFwkUVVBTElUWT0uKj9cJFwkJywgJycsIHVybCkNCiAgICAgICAgIyAgICAgICAgIHVybCA9IHVybGxpYi5xdW90ZSh1cmwpKycmYW1wO3E9JXMnJXENCiAgICAgICAgIyAgICAgICAgIGxpei5zZXRQYXRoKHVybCkNCiAgICAgICAgIyAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsImZhbHNlIikNCiAgICAgICAgIyAgICAgICAgIHNsUHJveHkucGxheVNMaW5rKHVybCwgbGl6KQ0KICAgICAgICAjICAgICAgICAgcmV0dXJuDQogICAgICAgICMgICAgZXhjZXB0Og0KICAgICAgICAjICAgICAgICBwYXNzDQoNCiAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICBpZiBub3Qgc2V0cmVzOg0KICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgbGl6KQ0KICAgICAgICAgICANCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpDQoNCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocA0KIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3Ng0KZGVmIGdldGVwZyhsaW5rKToNCiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspDQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpDQogICAgICAgIHVybC5jbG9zZSgpDQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikNCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykNCiAgICAgICAgc291cmNldWhyemVpdCA9IHNvdXJjZTNbMV0uc3BsaXQoJzxiciAvPjxhIGhyZWY9Ii8nKQ0KICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldDQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQ0KICAgICAgICBub3d0aXRsZSA9IHNvdXJjZXRpdGxlWzBdWzE3Omxlbihzb3VyY2V0aXRsZVswXSldDQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpDQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQ0KDQpkZWYgZ2V0X2VwZyh1cmwsIHJlZ2V4KToNCiAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaXRlbSA9IHJlLmZpbmRhbGwocmVnZXgsIGRhdGEpWzBdDQogICAgICAgICAgICByZXR1cm4gaXRlbQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IGZhaWxlZCcpDQogICAgICAgICAgICBhZGRvbl9sb2cocmVnZXgpDQogICAgICAgICAgICByZXR1cm4NCg0KIyNub3QgYSBnZW5lcmljIGltcGxlbWVuYXRpb24gYXMgaXQgbmVlZHMgdG8gY29udmVydCAgICAgICAgICAgIA0KZGVmIGQyeChkLCByb290PSJyb290IixuZXN0ZWQ9MCk6DQoNCiAgICBvcCA9IGxhbWJkYSB0YWc6ICc8JyArIHRhZyArICc+Jw0KICAgIGNsID0gbGFtYmRhIHRhZzogJzwvJyArIHRhZyArICc+XG4nDQoNCiAgICBtbCA9IGxhbWJkYSB2LHhtbDogeG1sICsgb3Aoa2V5KSArIHN0cih2KSArIGNsKGtleSkNCiAgICB4bWwgPSBvcChyb290KSArICdcbicgaWYgcm9vdCBlbHNlICIiDQoNCiAgICBmb3Iga2V5LHZsIGluIGQuaXRlcml0ZW1zKCk6DQogICAgICAgIHZ0eXBlID0gdHlwZSh2bCkNCiAgICAgICAgaWYgbmVzdGVkPT0wOiBrZXk9J3JlZ2V4JyAjZW5mb3JjaW5nIGFsbCB0b3AgbGV2ZWwgdGFncyB0byBiZSBuYW1lZCBhcyByZWdleA0KICAgICAgICBpZiB2dHlwZSBpcyBsaXN0OiANCiAgICAgICAgICAgIGZvciB2IGluIHZsOg0KICAgICAgICAgICAgICAgIHY9ZXNjYXBlKHYpDQogICAgICAgICAgICAgICAgeG1sID0gbWwodix4bWwpICAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiB2dHlwZSBpcyBkaWN0OiANCiAgICAgICAgICAgIHhtbCA9IG1sKCdcbicgKyBkMngodmwsTm9uZSxuZXN0ZWQrMSkseG1sKSAgICAgICAgIA0KICAgICAgICBpZiB2dHlwZSBpcyBub3QgbGlzdCBhbmQgdnR5cGUgaXMgbm90IGRpY3Q6IA0KICAgICAgICAgICAgaWYgbm90IHZsIGlzIE5vbmU6IHZsPWVzY2FwZSh2bCkNCiAgICAgICAgICAgICNwcmludCByZXByKHZsKQ0KICAgICAgICAgICAgaWYgdmwgaXMgTm9uZToNCiAgICAgICAgICAgICAgICB4bWwgPSBtbCh2bCx4bWwpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICN4bWwgPSBtbChlc2NhcGUodmwuZW5jb2RlKCJ1dGYtOCIpKSx4bWwpDQogICAgICAgICAgICAgICAgeG1sID0gbWwodmwuZW5jb2RlKCJ1dGYtOCIpLHhtbCkNCg0KICAgIHhtbCArPSBjbChyb290KSBpZiByb290IGVsc2UgIiINCg0KICAgIHJldHVybiB4bWwNCg0KeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdtb3ZpZXMnKQ0KDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfVU5TT1JURUQpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0xBQkVMKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9EQVRFKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9HRU5SRSkNCmV4Y2VwdDoNCiAgICBwYXNzDQoNCnBhcmFtcz1nZXRfcGFyYW1zKCkNCiNwcmludCAncGFyYW1zICcsIHJlcHIocGFyYW1zKQ0KDQp1cmw9Tm9uZQ0KbmFtZT1Ob25lDQptb2RlPU5vbmUNCnBsYXlsaXN0PU5vbmUNCmljb25pbWFnZT1Ob25lDQpmYW5hcnQ9RkFOQVJUDQpwbGF5bGlzdD1Ob25lDQpmYXZfbW9kZT1Ob25lDQpyZWdleHM9Tm9uZQ0KDQp0cnk6DQogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgaWNvbmltYWdlPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJpY29uaW1hZ2UiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHBsYXlsaXN0PWV2YWwodXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlsaXN0Il0pLnJlcGxhY2UoJ3x8JywnLCcpKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQ0KZXhjZXB0Og0KICAgIHBhc3MNCnBsYXlpdGVtPScnDQp0cnk6DQogICAgcGxheWl0ZW09dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlpdGVtIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KICAgDQphZGRvbl9sb2coIk1vZGU6ICIrc3RyKG1vZGUpKQ0KDQppZiBub3QgdXJsIGlzIE5vbmU6DQogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQ0KYWRkb25fbG9nKCJOYW1lOiAiK3N0cihuYW1lKSkNCg0KaWYgbm90IHBsYXlpdGVtID09Jyc6DQogICAgcz1nZXRTb3VwKCcnLGRhdGE9cGxheWl0ZW0pDQogICAgbmFtZSx1cmwscmVnZXhzPWdldEl0ZW1zKHMsTm9uZSxkb250TGluaz1UcnVlKQ0KICAgIG1vZGU9MTE3DQoNCmlmIG1vZGU9PU5vbmU6DQogICAgYWRkb25fbG9nKCJnZXRTb3VyY2VzIikNCiAgICBnZXRTb3VyY2VzKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MToNCiAgICBhZGRvbl9sb2coImdldERhdGEiKQ0KICAgIGRhdGE9Tm9uZQ0KICAgIA0KICAgIGlmIHJlZ2V4cyBhbmQgbGVuKHJlZ2V4cyk+MDoNCiAgICAgICAgZGF0YSxzZXRyZXNvbHZlZD1nZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkNCiAgICAgICAgI3ByaW50IGRhdGENCiAgICAgICAgI3VybD0nJw0KICAgICAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoJ2h0dHAnKSBvciBkYXRhLnN0YXJ0c3dpdGgoJ3NtYicpIG9yIGRhdGEuc3RhcnRzd2l0aCgnbmZzJykgb3IgZGF0YS5zdGFydHN3aXRoKCcvJyk6DQogICAgICAgICAgICB1cmw9ZGF0YQ0KICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICNjcmVhdGUgeG1sIGhlcmUNCiAgICANCiAgICBnZXREYXRhKHVybCxmYW5hcnQsZGF0YSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MjoNCiAgICBhZGRvbl9sb2coImdldENoYW5uZWxJdGVtcyIpDQogICAgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MzoNCiAgICBhZGRvbl9sb2coImdldFN1YkNoYW5uZWxJdGVtcyIpDQogICAgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09NDoNCiAgICBhZGRvbl9sb2coImdldEZhdm9yaXRlcyIpDQogICAgZ2V0RmF2b3JpdGVzKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09NToNCiAgICBhZGRvbl9sb2coImFkZEZhdm9yaXRlIikNCiAgICB0cnk6DQogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFzcw0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFzcw0KICAgIGFkZEZhdm9yaXRlKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsZmF2X21vZGUpDQoNCmVsaWYgbW9kZT09NjoNCiAgICBhZGRvbl9sb2coInJtRmF2b3JpdGUiKQ0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgcm1GYXZvcml0ZShuYW1lKQ0KDQplbGlmIG1vZGU9PTc6DQogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQ0KICAgIGFkZFNvdXJjZSh1cmwpDQoNCmVsaWYgbW9kZT09ODoNCiAgICBhZGRvbl9sb2coInJtU291cmNlIikNCiAgICBybVNvdXJjZShuYW1lKQ0KDQplbGlmIG1vZGU9PTk6DQogICAgYWRkb25fbG9nKCJkb3dubG9hZF9maWxlIikNCiAgICBkb3dubG9hZF9maWxlKG5hbWUsIHVybCkNCg0KZWxpZiBtb2RlPT0xMDoNCiAgICBhZGRvbl9sb2coImdldENvbW11bml0eVNvdXJjZXMiKQ0KICAgIGdldENvbW11bml0eVNvdXJjZXMoKQ0KDQplbGlmIG1vZGU9PTExOg0KICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikNCiAgICBhZGRTb3VyY2UodXJsKQ0KDQplbGlmIG1vZGU9PTEyOg0KICAgIGFkZG9uX2xvZygic2V0UmVzb2x2ZWRVcmwiKQ0KICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luIikgb3Igbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyIikgOg0KICAgICAgICBzZXRyZXM9VHJ1ZQ0KICAgICAgICBpZiAnJCRMU0RpcmVjdCQkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyQkTFNEaXJlY3QkJCcsJycpDQogICAgICAgICAgICBzZXRyZXM9RmFsc2UNCiAgICAgICAgaXRlbSA9IHhibWNndWkuTGlzdEl0ZW0ocGF0aD11cmwpDQogICAgICAgIGlmIG5vdCBzZXRyZXM6DQogICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsKQ0KICAgICAgICBlbHNlOiANCiAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgaXRlbSkNCiAgICBlbHNlOg0KIyAgICAgICAgcHJpbnQgJ05vdCBzZXR0aW5nIHNldFJlc29sdmVkVXJsJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpDQoNCmVsaWYgbW9kZT09MTM6DQogICAgYWRkb25fbG9nKCJwbGF5X3BsYXlsaXN0IikNCiAgICBwbGF5X3BsYXlsaXN0KG5hbWUsIHBsYXlsaXN0KQ0KDQplbGlmIG1vZGU9PTE0Og0KICAgIGFkZG9uX2xvZygiZ2V0X3htbF9kYXRhYmFzZSIpDQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE1Og0KICAgIGFkZG9uX2xvZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpDQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIFRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE2Og0KICAgIGFkZG9uX2xvZygiYnJvd3NlX2NvbW11bml0eSIpDQogICAgZ2V0Q29tbXVuaXR5U291cmNlcyh1cmwsYnJvd3NlPVRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE3IG9yIG1vZGU9PTExNzoNCiAgICBhZGRvbl9sb2coImdldFJlZ2V4UGFyc2VkIikNCiAgICAjcHJpbnQgJ2dldFJlZ2V4UGFyc2VkJw0KICAgIGRhdGE9Tm9uZQ0KICAgIGlmIHJlZ2V4cyBhbmQgJ2xpc3RyZXBlYXQnIGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKToNCiAgICAgICAgbGlzdHJlcGVhdCxyZXQsbSxyZWdleHMsIGNvb2tpZUphciA9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpDQogICAgICAgICNwcmludCBsaXN0cmVwZWF0LHJldCxtLHJlZ2V4cw0KICAgICAgICBkPScnDQojICAgICAgICBwcmludCAnbSBpcycgLCBtDQojICAgICAgICBwcmludCAncmVnZXhzJyxyZWdleHMNCiAgICAgICAgcmVnZXhuYW1lPW1bJ25hbWUnXQ0KICAgICAgICBleGlzdGluZ19saXN0PXJlZ2V4cy5wb3AocmVnZXhuYW1lKQ0KICMgICAgICAgcHJpbnQgJ2ZpbmFsIHJlZ2V4cycscmVnZXhzLHJlZ2V4bmFtZQ0KICAgICAgICB1cmw9JycNCiAgICAgICAgaW1wb3J0IGNvcHkNCiAgICAgICAgbG49JycNCiAgICAgICAgcm51bWJlcj0wDQogICAgICAgIGZvciBvYmogaW4gcmV0Og0KICAgICAgICAgICAgI3ByaW50ICdvYmonLG9iag0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHJudW1iZXIrPTENCiAgICAgICAgICAgICAgICBuZXdjb3B5PWNvcHkuZGVlcGNvcHkocmVnZXhzKQ0KICAgICMgICAgICAgICAgICBwcmludCAnbmV3Y29weScsbmV3Y29weSwgbGVuKG5ld2NvcHkpDQogICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdA0KICAgICAgICAgICAgICAgIGk9MA0KICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihvYmopKToNCiAgICAjICAgICAgICAgICAgICAgIHByaW50ICdpIGlzICcsaSwgbGVuKG9iaiksIGxlbihuZXdjb3B5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4obmV3Y29weSk+MDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5TywgdGhlX3ZhbHVlTyBpbiBuZXdjb3B5Lml0ZXJpdGVtcygpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZU8gaXMgbm90IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5LCB0aGVfdmFsdWUgaW4gdGhlX3ZhbHVlTy5pdGVyaXRlbXMoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZSBpcyBub3QgTm9uZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAgJ2tleSBhbmQgdmFsJyx0aGVfa2V5LCB0aGVfdmFsdWUNCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FhJw0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScNCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgcmVwcihvYmpbaV0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZSh0aGVfdmFsdWUpIGlzIGRpY3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5bCwgdGhlX3ZhbHVlbCBpbiB0aGVfdmFsdWUuaXRlcml0ZW1zKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWVsIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9ialtpXS5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9ialtpXSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iai5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0gb2JqDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyBpbiB0aGVfdmFsdWVsOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVsPXRoZV92YWx1ZWwucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXVtERV0nLCB1bmVzY2FwZSh2YWwpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZV92YWx1ZVt0aGVfa2V5bF09dGhlX3ZhbHVlbC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZmlyc3Qgc2VjJyx0aGVfdmFsdWVbdGhlX2tleWxdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPU5vbmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqW2ldLmRlY29kZSgndXRmLTgnKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqW2ldIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0gb2JqLmRlY29kZSgndXRmLTgnKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iag0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXVtERV0nIGluIHRoZV92YWx1ZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZm91bmQgREUnLHRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScsIHVuZXNjYXBlKHZhbCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWU9dGhlX3ZhbHVlLnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJywgdW5lc2NhcGUodmFsKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVPW3RoZV9rZXldPXRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NlY29uZCBzZWMgdmFsJyx0aGVfdmFsdWVPW3RoZV9rZXldDQoNCiAgICAgICAgICAgICAgICAgICAgdmFsPU5vbmUNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmpbaV0uZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW9ialtpXQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmouZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmoNCiAgICAgICAgICAgICAgICAgICAgaWYgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyBpbiBsaXN0cmVwZWF0VDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyx2YWwpDQogICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLGVzY2FwZSh2YWwpKQ0KIyAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGlzdHJlcGVhdFQNCiAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoMCkgKyAnXScsc3RyKHJudW1iZXIpKSANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphciBhbmQgJ1snICsgcmVnZXhuYW1lKycuY29va2llc10nIGluIGxpc3RyZXBlYXRUOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdFQucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5jb29raWVzXScsZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpKSANCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjbmV3Y29weSA9IHVybGxpYi5xdW90ZShyZXByKG5ld2NvcHkpKQ0KICAgICMgICAgICAgICAgICBwcmludCAnbmV3IHJlZ2V4IGxpc3QnLCByZXByKG5ld2NvcHkpLCByZXByKGxpc3RyZXBlYXRUKQ0KICAgICMgICAgICAgICAgICBhZGRMaW5rKGxpc3RsaW5rVCxsaXN0dGl0bGVULmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksbGlzdHRodW1ibmFpbFQsJycsJycsJycsJycsVHJ1ZSxOb25lLG5ld2NvcHksIGxlbihyZXQpKQ0KICAgICAgICAgICAgICAgIHJlZ2V4X3htbD0nJw0KIyAgICAgICAgICAgICAgICBwcmludCAnbmV3Y29weScsbmV3Y29weQ0KICAgICAgICAgICAgICAgIGlmIGxlbihuZXdjb3B5KT4wOg0KICAgICAgICAgICAgICAgICAgICByZWdleF94bWw9ZDJ4KG5ld2NvcHksJ2xzcHJvcm9vdCcpDQogICAgICAgICAgICAgICAgICAgIHJlZ2V4X3htbD1yZWdleF94bWwuc3BsaXQoJzxsc3Byb3Jvb3Q+JylbMV0uc3BsaXQoJzwvbHNwcm9yb290JylbMF0NCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgI2xuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQuZW5jb2RlKCJ1dGYtOCIpLHJlZ2V4X3htbCkgICANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGxuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQscmVnZXhfeG1sKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDogbG4rPSdcbjxpdGVtPiVzXG4lczwvaXRlbT4nJShsaXN0cmVwZWF0VC5lbmNvZGUoInV0Zi04IikscmVnZXhfeG1sKQ0KICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiMgICAgICAgICAgICBwcmludCByZXByKGxuKQ0KIyAgICAgICAgICAgIHByaW50IG5ld2NvcHkNCiAgICAgICAgICAgICAgICANCiMgICAgICAgICAgICBsbis9JzwvaXRlbT4nDQogICAgICAgIA0KICAgICAgICBhZGRvbl9sb2cocmVwcihsbikpDQogICAgICAgIGdldERhdGEoJycsJycsbG4pDQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCiAgICBlbHNlOg0KICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkNCiAgICAgICAgI3ByaW50ICdpbWhlcmUnLCByZXByKHVybCksc2V0cmVzb2x2ZWQsbmFtZQ0KICAgICAgICAjcHJpbnQgJ2ltaGVyZScNCiAgICAgICAgaWYgbm90IChyZWdleHMgYW5kICdub3RwbGF5YWJsZScgaW4gcmVnZXhzIGFuZCBub3QgdXJsKTogICAgICAgIA0KICAgICAgICAgICAgaWYgdXJsOg0KICAgICAgICAgICAgICAgIGlmICckUExBWUVSUFJPWFkkPScgaW4gdXJsOg0KICAgICAgICAgICAgICAgICAgICB1cmwscHJveHk9dXJsLnNwbGl0KCckUExBWUVSUFJPWFkkPScpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwcm94eScscHJveHkNCiAgICAgICAgICAgICAgICAgICAgI0phaXJveCBtb2QgZm9yIHByb3h5IGF1dGgNCiAgICAgICAgICAgICAgICAgICAgcHJveHl1c2VyID0gTm9uZQ0KICAgICAgICAgICAgICAgICAgICBwcm94eXBhc3MgPSBOb25lDQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihwcm94eSkgPiAwIGFuZCAnQCcgaW4gcHJveHk6DQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHByb3h5LnNwbGl0KCc6JykNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5dXNlciA9IHByb3h5WzBdDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXBhc3MgPSBwcm94eVsxXS5zcGxpdCgnQCcpWzBdDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eWlwID0gcHJveHlbMV0uc3BsaXQoJ0AnKVsxXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcG9ydCA9IHByb3h5WzJdDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eWlwLHBvcnQ9cHJveHkuc3BsaXQoJzonKQ0KDQogICAgICAgICAgICAgICAgICAgIHBsYXltZWRpYXdpdGhwcm94eSh1cmwsbmFtZSxpY29uaW1hZ2UscHJveHlpcCxwb3J0LCBwcm94eXVzZXIscHJveHlwYXNzKSAjamFpcm94DQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZCxyZWdleHMpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EsRmFpbGVkIHRvIGV4dHJhY3QgcmVnZXguIC0gIisidGhpcyIrIiw0MDAwLCIraWNvbisiKSIpDQoNCmVsaWYgbW9kZT09MTg6DQogICAgYWRkb25fbG9nKCJ5b3V0dWJlZGwiKQ0KICAgIHRyeToNCiAgICAgICAgaW1wb3J0IHlvdXR1YmVkbA0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EsUGxlYXNlIFtDT0xPUiB5ZWxsb3ddaW5zdGFsbCBZb3V0dWJlLWRsWy9DT0xPUl0gbW9kdWxlICwxMDAwMCwiIikiKQ0KICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpDQogICAgcGxheXNldHJlc29sdmVkKHN0cmVhbV91cmwsbmFtZSxpY29uaW1hZ2UpDQoNCmVsaWYgbW9kZT09MTk6DQogICAgYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikNCiAgICBwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpDQoNCmVsaWYgbW9kZT09MjA6DQogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpDQogICAgaXRlbSA9IHhibWNndWkuTGlzdEl0ZW0ocGF0aD11cmwpDQogICAgaWYgJ3wnIGluIHVybDoNCiAgICAgICAgdXJsLHN0cmhkciA9IHVybC5zcGxpdCgnfCcpDQogICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ2lucHV0c3RyZWFtLmFkYXB0aXZlLnN0cmVhbV9oZWFkZXJzJywgc3RyaGRyKQ0KICAgICAgICBpdGVtLnNldFBhdGgodXJsKQ0KICAgIGlmICcubTN1OCcgaW4gdXJsOg0KICAgICAgICBpdGVtLnNldFByb3BlcnR5KCdpbnB1dHN0cmVhbWFkZG9uJywgJ2lucHV0c3RyZWFtLmFkYXB0aXZlJykNCiAgICAgICAgaXRlbS5zZXRQcm9wZXJ0eSgnaW5wdXRzdHJlYW0uYWRhcHRpdmUubWFuaWZlc3RfdHlwZScsICdobHMnKQ0KICAgICAgICBpdGVtLnNldE1pbWVUeXBlKCdhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3N0cmVhbV91cmwnKQ0KICAgICAgICBpdGVtLnNldENvbnRlbnRMb29rdXAoRmFsc2UpDQogICANCiAgICBlbGlmICcubXBkJyBpbiB1cmw6DQogICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ2lucHV0c3RyZWFtYWRkb24nLCAnaW5wdXRzdHJlYW0uYWRhcHRpdmUnKQ0KICAgICAgICBpdGVtLnNldFByb3BlcnR5KCdpbnB1dHN0cmVhbS5hZGFwdGl2ZS5tYW5pZmVzdF90eXBlJywgJ21wZCcpDQogICAgICAgIGl0ZW0uc2V0TWltZVR5cGUoJ2FwcGxpY2F0aW9uL2Rhc2greG1sJykNCiAgICAgICAgaXRlbS5zZXRDb250ZW50TG9va3VwKEZhbHNlKQ0KICAgIA0KICAgIGVsaWYgJy5pc20nIGluIHVybDoNCiAgICAgICAgaXRlbS5zZXRQcm9wZXJ0eSgnaW5wdXRzdHJlYW1hZGRvbicsICdpbnB1dHN0cmVhbS5hZGFwdGl2ZScpDQogICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ2lucHV0c3RyZWFtLmFkYXB0aXZlLm1hbmlmZXN0X3R5cGUnLCAnaXNtJykNCiAgICAgICAgaXRlbS5zZXRNaW1lVHlwZSgnYXBwbGljYXRpb24vdm5kLm1zLXNzdHIreG1sJykNCiAgICAgICAgaXRlbS5zZXRDb250ZW50TG9va3VwKEZhbHNlKQ0KDQogICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBpdGVtKQ0KDQplbGlmIG1vZGU9PTIxOg0KICAgIGFkZG9uX2xvZygiZG93bmxvYWQgY3VycmVudCBmaWxlIHVzaW5nIHlvdXR1YmUtZGwgc2VydmljZSIpDQogICAgbXR5cGU9J3ZpZGVvJw0KICAgIGlmICdbbXAzXScgaW4gbmFtZToNCiAgICAgICAgbXR5cGU9J2F1ZGlvJw0KICAgICAgICBuYW1lPW5hbWUucmVwbGFjZSgnW21wM10nLCcnKQ0KICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwgbXR5cGUpDQoNCmVsaWYgbW9kZT09MjI6DQogICAgcHJpbnQgInNscHJveHkiDQogICAgdHJ5Og0KICAgICAgICBmcm9tIGRzcCBpbXBvcnQgc3RyZWFtbGlua19wcm94eQ0KICAgICAgICBzbFByb3h5ID0gc3RyZWFtbGlua19wcm94eS5TTFByb3h5X0hlbHBlcigpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHEgPSAgcmUuZmluZGFsbChyJ1wkXCRRVUFMSVRZPShbXlwkXCRdKylcJFwkJywgdXJsKVswXQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBxID0gJ2Jlc3QnDQogICAgICAgIHVybCA9IHJlLnN1YihyJ1wkXCRRVUFMSVRZPS4qP1wkXCQnLCAnJywgdXJsKQ0KICAgICAgICB1cmwgPSB1cmxsaWIucXVvdGUodXJsKSsnJmFtcDtxPSVzJyVxDQogICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbShzdHIobmFtZSkpDQogICAgICAgIGxpc3RpdGVtLnNldEluZm8oJ3ZpZGVvJywgeydUaXRsZSc6IHN0cihuYW1lKX0pDQogICAgICAgIGxpc3RpdGVtLnNldFBhdGgodXJsKSAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIHNsUHJveHkucGxheVNMaW5rKHVybCwgbGlzdGl0ZW0pDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQoNCmVsaWYgbW9kZT09MjM6DQogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikNCiAgICBtdHlwZT0ndmlkZW8nDQogICAgaWYgJ1ttcDNdJyBpbiBuYW1lOg0KICAgICAgICBtdHlwZT0nYXVkaW8nDQogICAgICAgIG5hbWU9bmFtZS5yZXBsYWNlKCdbbXAzXScsJycpDQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSxtdHlwZSkNCg0KZWxpZiBtb2RlPT0yNDoNCiAgICBhZGRvbl9sb2coIkF1ZGlvIG9ubHkgeW91dHViZSBkb3dubG9hZCIpDQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwnYXVkaW8nKQ0KDQplbGlmIG1vZGU9PTI1Og0KICAgIGFkZG9uX2xvZygiU2VhcmNoaW4gT3RoZXIgcGx1Z2lucyIpDQogICAgX3NlYXJjaCh1cmwsbmFtZSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09NTU6DQogICAgYWRkb25fbG9nKCJlbmFibGVkIGxvY2siKQ0KICAgIHBhcmVudGFsYmxvY2tlZHBpbiA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkcGluJykNCiAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ0VudGVyIFBpbicpDQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpDQogICAgaWYgbm90IChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgbmV3U3RyID0ga2V5Ym9hcmQuZ2V0VGV4dCgpDQogICAgICAgIGlmIG5ld1N0cj09cGFyZW50YWxibG9ja2VkcGluOg0KICAgICAgICAgICAgYWRkb24uc2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJywgImZhbHNlIikNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EsUGFyZW50YWwgQmxvY2sgRGlzYWJsZWQsNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oQW5kcm9pZHJlcHVibGljYSxXcm9uZyBQaW4/Pyw1MDAwLCIraWNvbisiKSIpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KICAgIA0KZWxpZiBtb2RlPT01NjoNCiAgICBhZGRvbl9sb2coImRpc2FibGUgbG9jayIpDQogICAgYWRkb24uc2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJywgInRydWUiKQ0KICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEFuZHJvaWRyZXB1YmxpY2EsUGFyZW50YWwgYmxvY2sgZW5hYmxlZCw1MDAwLCIraWNvbisiKSIpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTUzOg0KICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpDQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQ0KICAgICN4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmlmIG5vdCB2aWV3bW9kZT09Tm9uZToNCiAgIHByaW50ICdzZXR0aW5nIHZpZXcgbW9kZScNCiAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSglcykiJXZpZXdtb2RlKQ==')
    
